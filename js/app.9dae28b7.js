(function(){"use strict";var e={440:function(e,a,t){var l=t(5130),n=t(657),s=t(6768);const i={id:"app",class:"d-flex flex-column vh-100"},r={class:"d-flex flex-column overflow-hidden"};function o(e,a,t,l,n,o){const u=(0,s.g2)("router-view");return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("div",r,[(0,s.bF)(u)])])}var u={name:"App",components:{},setup(){return{}}},c=t(1241);const d=(0,c.A)(u,[["render",o]]);var v=d,p=t(8728),g=t(4232);const y={id:"app",class:"d-flex flex-column vh-100"},m={class:"d-flex flex-column overflow-hidden"},h={key:0,class:"h-100"},f={key:1,class:"h-100 d-flex flex-column overflow-hidden"},b={class:"d-none d-xl-flex flex-row overflow-hidden h-100"},k={class:"d-flex d-xl-none flex-column overflow-hidden h-100"},L={class:"d-none d-xl-flex justify-content-between my-app-footer my-title-sm-white my-bgcolor-gray-800 p-2",ref:"appFooterRef"};function w(e,a,t,l,n,i){const r=(0,s.g2)("LoadingOverlay"),o=(0,s.g2)("router-view"),u=(0,s.g2)("LeftView"),c=(0,s.g2)("MiddleView"),d=(0,s.g2)("RightView"),v=(0,s.g2)("UpperView"),p=(0,s.g2)("ResponsiveLowerView");return(0,s.uX)(),(0,s.CE)("div",y,[(0,s.bF)(r,{isVisible:l.isAnyLayerLoading,loadingText:l.loadingText,progress:l.loadingProgress,showProgress:l.showLoadingProgress,subText:l.loadingSubText},null,8,["isVisible","loadingText","progress","showProgress","subText"]),(0,s.Lk)("div",m,["/"!==e.$route.path?((0,s.uX)(),(0,s.CE)("div",h,[(0,s.bF)(o)])):(0,s.Q3)("",!0),"/"===e.$route.path?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("div",b,[l.leftViewWidth>0?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"h-100 overflow-y-auto overflow-x-hidden my-left-panel",style:(0,g.Tr)({width:l.leftViewWidthPx})},[(0,s.bF)(u)],4)):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:(0,g.C4)(["my-resizer my-resizer-vertical my-resizer-left",{"my-dragging":l.isSidePanelDragging}]),onMousedown:a[0]||(a[0]=e=>l.startResize("left",e)),title:"æ‹–æ›³èª¿æ•´å·¦å´é¢æ¿å¯¬åº¦"},null,34),(0,s.bF)(c,{ref:"middlePanelRef",class:"d-flex flex-column overflow-hidden h-100 my-middle-panel",style:(0,g.Tr)([{"z-index":"1"},{width:l.mainPanelWidthPx,"min-width":"0px"}]),dynamicMainAreaHeight:l.calculatedMiddleViewHeight,activeUpperTab:l.activeUpperTab,activeBottomTab:l.activeBottomTab,mainPanelWidth:l.mainPanelWidth,selectedFilter:null,zoomLevel:l.zoomLevel,currentCoords:l.currentCoords,activeMarkers:l.activeMarkers,isLoadingData:l.isAnyLayerLoading,isSidePanelDragging:l.isSidePanelDragging,"onUpdate:activeUpperTab":a[1]||(a[1]=e=>l.activeUpperTab=e),"onUpdate:activeBottomTab":a[2]||(a[2]=e=>l.activeBottomTab=e),"onUpdate:zoomLevel":a[3]||(a[3]=e=>l.zoomLevel=e),"onUpdate:currentCoords":a[4]||(a[4]=e=>l.currentCoords=e),"onUpdate:activeMarkers":a[5]||(a[5]=e=>l.activeMarkers=e),onResetView:l.resetView,onHighlightOnMap:l.handleHighlight,onHighlightFeature:l.handleHighlight,onFeatureSelected:l.handleFeatureSelected},null,8,["style","dynamicMainAreaHeight","activeUpperTab","activeBottomTab","mainPanelWidth","zoomLevel","currentCoords","activeMarkers","isLoadingData","isSidePanelDragging","onResetView","onHighlightOnMap","onHighlightFeature","onFeatureSelected"]),(0,s.Lk)("div",{class:(0,g.C4)(["my-resizer my-resizer-vertical my-resizer-right",{"my-dragging":l.isSidePanelDragging}]),onMousedown:a[6]||(a[6]=e=>l.startResize("right",e)),title:"æ‹–æ›³èª¿æ•´å³å´é¢æ¿å¯¬åº¦"},null,34),l.rightViewWidth>0?((0,s.uX)(),(0,s.CE)("div",{key:1,class:"h-100 overflow-auto",style:(0,g.Tr)({width:l.rightViewWidthPx})},[(0,s.bF)(d,{activeRightTab:l.activeRightTab,activeMarkers:l.activeMarkers,rightViewWidth:l.rightViewWidth,"onUpdate:activeRightTab":a[7]||(a[7]=e=>l.activeRightTab=e),onHighlightFeature:l.handleHighlight,"current-coords":l.currentCoords},null,8,["activeRightTab","activeMarkers","rightViewWidth","onHighlightFeature","current-coords"])],4)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",k,[l.mobileBottomViewHeight<100?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"flex-shrink-0 overflow-hidden d-flex flex-column",style:(0,g.Tr)({height:100-l.mobileBottomViewHeight+"vh"})},[((0,s.uX)(),(0,s.Wv)(v,{ref:"mobileUpperViewRef",key:l.mobileMapKey,activeUpperTab:l.activeUpperTab,mainPanelWidth:100,contentHeight:l.mobileUpperContentHeight,selectedFilter:null,zoomLevel:l.zoomLevel,isPanelDragging:l.isVerticalDragging,activeMarkers:l.activeMarkers,"onUpdate:activeUpperTab":a[8]||(a[8]=e=>l.activeUpperTab=e),"onUpdate:zoomLevel":a[9]||(a[9]=e=>l.zoomLevel=e),"onUpdate:currentCoords":a[10]||(a[10]=e=>l.currentCoords=e),"onUpdate:activeMarkers":a[11]||(a[11]=e=>l.activeMarkers=e),onFeatureSelected:l.handleFeatureSelected},null,8,["activeUpperTab","contentHeight","zoomLevel","isPanelDragging","activeMarkers","onFeatureSelected"]))],4)):(0,s.Q3)("",!0),l.mobileBottomViewHeight>0&&l.mobileBottomViewHeight<100?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,g.C4)(["my-resizer my-resizer-horizontal my-resizer-middle",{"my-dragging":l.isVerticalDragging}]),onMousedown:a[12]||(a[12]=(...e)=>l.startVerticalResize&&l.startVerticalResize(...e)),onTouchstart:a[13]||(a[13]=(...e)=>l.startVerticalResize&&l.startVerticalResize(...e)),title:"æ‹–æ›³èª¿æ•´åº•éƒ¨é¢æ¿é«˜åº¦"},null,34)):(0,s.Q3)("",!0),l.mobileBottomViewHeight>0?((0,s.uX)(),(0,s.CE)("div",{key:2,class:"flex-shrink-0 overflow-hidden",style:(0,g.Tr)({height:l.mobileBottomViewHeight+"vh"})},[(0,s.bF)(p,{activeTab:l.activeLowerTab,activeRightTab:l.activeRightTab,activeBottomTab:l.activeBottomTab,"onUpdate:activeTab":a[14]||(a[14]=e=>l.activeLowerTab=e),"onUpdate:activeRightTab":a[15]||(a[15]=e=>l.activeRightTab=e),"onUpdate:activeBottomTab":a[16]||(a[16]=e=>l.activeBottomTab=e),onHighlightOnMap:l.handleHighlight,onHighlightFeature:l.handleHighlight,onFeatureSelected:l.handleFeatureSelected},null,8,["activeTab","activeRightTab","activeBottomTab","onHighlightOnMap","onHighlightFeature","onFeatureSelected"])],4)):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)]),(0,s.Lk)("footer",L,[...a[17]||(a[17]=[(0,s.Lk)("small",null,"è‡ºç£å¤§å­¸åœ°ç†ç’°å¢ƒè³‡æºå­¸ç³»",-1),(0,s.Lk)("small",null,"2025",-1)])],512)])}t(8111),t(116),t(3579);var x=t(144);t(4114),t(2489);const T=(0,n.nY)("data",()=>{const e=(0,x.KR)({}),a=(0,x.KR)([{groupName:"æ¸¬è©¦åœ–å±¤",groupLayers:[{layerId:"test_layer",layerName:"æ¸¬è©¦",visible:!1,isLoading:!1,isLoaded:!1,colorName:"green",jsonData:null,processedJsonData:null,workData:null,dashboardData:null,dataTableData:null,layerInfoData:null,jsonLoader:null,jsonFileName:null,display:!0,upperViewTabs:["work","dashboard"]}]}]),t=(a,t)=>{e.value[a]||(e.value[a]={}),Object.assign(e.value[a],t)},l=e=>{for(const t of a.value)for(const a of t.groupLayers)if(a.layerId===e)return a;return null},n=()=>{const e=[];for(const t of a.value)e.push(...t.groupLayers);return e},i=async e=>{const a=l(e);if(!a)return void console.error(`âŒ DataStore: Layer with id "${e}" not found.`);a.visible=!a.visible,t(e,{visible:a.visible});const n=a.visible&&!a.isLoaded&&!a.isLoading&&(a.jsonLoader||a.geojsonLoader);if(n)try{let l;if(a.isLoading=!0,t(e,{isLoading:a.isLoading}),a.jsonLoader)l=await a.jsonLoader(a);else{if(!a.geojsonLoader)throw new Error("åœ–å±¤æ²’æœ‰æœ‰æ•ˆçš„æ•¸æ“šè¼‰å…¥å™¨ï¼ˆå¿…é ˆè¨­ç½® jsonLoader æˆ– geojsonLoaderï¼‰");l=await a.geojsonLoader(a)}a.jsonData=l.jsonData,a.spaceNetworkGridJsonData=l.spaceNetworkGridJsonData??a.spaceNetworkGridJsonData,a.layoutGridJsonData=l.layoutGridJsonData??a.layoutGridJsonData,a.layoutGridJsonData_Test=l.layoutGridJsonData_Test??a.layoutGridJsonData_Test,a.layoutGridJsonData_Test2=l.layoutGridJsonData_Test2??a.layoutGridJsonData_Test2,a.layoutGridJsonData_Test3=l.layoutGridJsonData_Test3??a.layoutGridJsonData_Test3,a.layoutGridJsonData_Test4=l.layoutGridJsonData_Test4??a.layoutGridJsonData_Test4,a.processedJsonData=l.processedJsonData,a.geojsonData=l.geojsonData||null,a.dataTableData=l.dataTableData,a.dashboardData=l.dashboardData,a.layerInfoData=l.layerInfoData,a.processToDrawData&&a.processedJsonData&&(a.drawJsonData=a.processToDrawData(a.processedJsonData)),a.isLoaded=!0,t(e,{isLoaded:a.isLoaded,jsonData:a.jsonData,spaceNetworkGridJsonData:a.spaceNetworkGridJsonData,layoutGridJsonData:a.layoutGridJsonData,layoutGridJsonData_Test:a.layoutGridJsonData_Test,layoutGridJsonData_Test2:a.layoutGridJsonData_Test2,layoutGridJsonData_Test3:a.layoutGridJsonData_Test3,processedJsonData:a.processedJsonData,geojsonData:a.geojsonData,drawJsonData:a.drawJsonData,dataTableData:a.dataTableData,dashboardData:a.dashboardData,layerInfoData:a.layerInfoData})}catch(s){console.error(`âŒ è¼‰å…¥åœ–å±¤ "${a.layerName}" å¤±æ•—:`,s),a.visible=!1,t(e,{visible:!1})}finally{a.isLoading=!1,t(e,{isLoading:!1})}},r=(0,x.KR)(null),o=(0,x.KR)({width:0,height:0}),u=(e,a)=>{o.value={width:Math.round(e),height:Math.round(a)}},c=(a,t)=>{e.value[a]||(e.value[a]={}),e.value[a].computedGridState={visibleX:t.visibleX,visibleY:t.visibleY,cellWidth:Math.round(t.cellWidth),cellHeight:Math.round(t.cellHeight),updatedAt:Date.now()}},d=(0,x.KR)({x:0,y:0}),v=(e,a)=>{d.value={x:Math.round(e),y:Math.round(a)}},p=(0,x.KR)({minWidth:0,minHeight:0}),g=(e,a)=>{p.value={minWidth:Math.round(e),minHeight:Math.round(a)}},y=(0,x.KR)({x:0,y:0}),m=(e,a)=>{y.value={x:Math.round(e),y:Math.round(a)}},h=(0,x.KR)({minWidth:0,minHeight:0}),f=(e,a)=>{h.value={minWidth:Math.round(e),minHeight:Math.round(a)}},b=(0,x.KR)({x:0,y:0}),k=(e,a)=>{b.value={x:Math.round(e),y:Math.round(a)}},L=(0,x.KR)({minWidth:0,minHeight:0}),w=(0,x.KR)(!0),T=e=>{w.value=!!e},C=(0,x.KR)(!1),D=e=>{C.value=!!e},E=(0,x.KR)(!1),_=e=>{E.value=!!e},R=(0,x.KR)(!0),I=e=>{R.value=!!e},X=(0,x.KR)(!1),M=e=>{X.value=!!e},F=(0,x.KR)(null),K=(e,a)=>{L.value={minWidth:Math.round(e),minHeight:Math.round(a)}},W=e=>{F.value=e},j=()=>{F.value=null},z=(0,x.KR)(5),S=e=>{const a=Number(e);!isNaN(a)&&a>0&&(z.value=a)},N=(0,x.KR)(5),A=e=>{const a=Number(e);!isNaN(a)&&a>0&&(N.value=a)},G=(0,x.KR)({x:null,y:null}),$=(e,a)=>{G.value={x:null!==e&&void 0!==e?Math.round(e):null,y:null!==a&&void 0!==a?Math.round(a):null}},P=()=>{G.value={x:null,y:null}},V=(0,x.KR)(2),J=e=>{const a=Number(e);!isNaN(a)&&a>0&&(V.value=a)},H=e=>{r.value=e},B=()=>{r.value=null},U=async e=>{const a=l(e);if(a){if(a.isLoaded=!1,a.isLoading=!1,a.visible&&(a.jsonLoader||a.geojsonLoader))try{let l;a.isLoading=!0,t(e,{isLoading:a.isLoading}),a.jsonLoader?l=await a.jsonLoader(a):a.geojsonLoader&&(l=await a.geojsonLoader(a)),a.jsonData=l.jsonData,a.spaceNetworkGridJsonData=l.spaceNetworkGridJsonData??a.spaceNetworkGridJsonData,a.layoutGridJsonData=l.layoutGridJsonData??a.layoutGridJsonData,a.layoutGridJsonData_Test=l.layoutGridJsonData_Test??a.layoutGridJsonData_Test,a.layoutGridJsonData_Test2=l.layoutGridJsonData_Test2??a.layoutGridJsonData_Test2,a.layoutGridJsonData_Test3=l.layoutGridJsonData_Test3??a.layoutGridJsonData_Test3,a.layoutGridJsonData_Test4=l.layoutGridJsonData_Test4??a.layoutGridJsonData_Test4,a.geojsonData=l.geojsonData??a.geojsonData,a.processedJsonData=l.processedJsonData??a.processedJsonData,a.drawJsonData=l.drawJsonData??a.drawJsonData,a.dashboardData=l.dashboardData??a.dashboardData,a.dataTableData=l.dataTableData??a.dataTableData,a.layerInfoData=l.layerInfoData??a.layerInfoData,a.isLoaded=!0,a.isLoading=!1,t(e,{isLoaded:a.isLoaded,isLoading:a.isLoading}),console.log(`âœ… DataStore: Layer "${e}" reloaded successfully.`)}catch(n){console.error(`âŒ DataStore: Failed to reload layer "${e}":`,n),a.isLoading=!1,t(e,{isLoading:a.isLoading})}}else console.error(`âŒ DataStore: Layer with id "${e}" not found.`)},Q=e=>{for(const t of a.value)for(const a of t.groupLayers)if(a.layerId===e)return t.groupName;return null};return{layers:a,findLayerById:l,getAllLayers:n,findGroupNameByLayerId:Q,toggleLayerVisibility:i,reloadLayer:U,selectedFeature:r,setSelectedFeature:H,clearSelectedFeature:B,visibleLayers:(0,s.EW)(()=>n().filter(e=>e.visible)),loadingLayers:(0,s.EW)(()=>n().filter(e=>e.isLoading)),layerStates:e,saveLayerState:t,d3jsDimensions:o,updateD3jsDimensions:u,updateComputedGridState:c,layoutGridTabTest2Dimensions:d,updateLayoutGridTabTest2Dimensions:v,layoutGridTabTest2MinCellDimensions:p,updateLayoutGridTabTest2MinCellDimensions:g,layoutGridTabTest3Dimensions:y,updateLayoutGridTabTest3Dimensions:m,layoutGridTabTest3MinCellDimensions:h,updateLayoutGridTabTest3MinCellDimensions:f,layoutGridTabTest4Dimensions:b,updateLayoutGridTabTest4Dimensions:k,layoutGridTabTest4MinCellDimensions:L,updateLayoutGridTabTest4MinCellDimensions:K,layoutGridTabTest4MouseGridCoordinate:G,updateLayoutGridTabTest4MouseGridCoordinate:$,clearLayoutGridTabTest4MouseGridCoordinate:P,showWeightLabels:w,setShowWeightLabels:T,showRouteThickness:C,setShowRouteThickness:D,enableWeightScaling:E,setEnableWeightScaling:_,showGrid:R,setShowGrid:I,showStationNames:X,setShowStationNames:M,currentMergeOperation4:F,setCurrentMergeOperation4:W,clearCurrentMergeOperation4:j,autoMergeThreshold:z,setAutoMergeThreshold:S,weightScalingExponent:V,setWeightScalingExponent:J,weightScalingMultiplier:N,setWeightScalingMultiplier:A}},{persist:!0}),C={key:0,class:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{"background-color":"rgba(0, 0, 0, 0.7)","z-index":"9999"}},D={class:"text-center my-bgcolor-white p-4 rounded shadow",style:{"min-width":"300px","max-width":"400px"}},E={class:"my-title-lg-black"},_={key:0,class:"mt-3"},R={class:"progress",style:{height:"8px"}},I=["aria-valuenow"],X={key:1,class:"mt-2"},M={class:"my-content-xs-gray"};function F(e,a,t,l,n,i){return t.isVisible?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("div",D,[a[0]||(a[0]=(0,s.Lk)("div",{class:"spinner-border text-primary mb-3",style:{width:"2rem",height:"2rem"},role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"è¼‰å…¥ä¸­...")],-1)),(0,s.Lk)("div",E,(0,g.v_)(t.loadingText),1),t.showProgress&&t.progress>=0?((0,s.uX)(),(0,s.CE)("div",_,[(0,s.Lk)("div",R,[(0,s.Lk)("div",{class:"progress-bar bg-primary d-flex align-items-center justify-content-center",role:"progressbar",style:(0,g.Tr)([{width:t.progress+"%"},{transition:"width 0.3s ease","font-size":"0.75rem",color:"white"}]),"aria-valuenow":t.progress,"aria-valuemin":"0","aria-valuemax":"100"},(0,g.v_)(Math.round(t.progress))+"% ",13,I)])])):(0,s.Q3)("",!0),t.subText?((0,s.uX)(),(0,s.CE)("div",X,[(0,s.Lk)("small",M,(0,g.v_)(t.subText),1)])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)}var K={name:"LoadingOverlay",props:{isVisible:{type:Boolean,default:!1,required:!0},loadingText:{type:String,default:"è¼‰å…¥ä¸­..."},progress:{type:Number,default:-1,validator:e=>e>=-1&&e<=100},showProgress:{type:Boolean,default:!1},subText:{type:String,default:""}}};const W=(0,c.A)(K,[["render",F]]);var j=W;const z={class:"my-bgcolor-gray-100 h-100 d-flex flex-column overflow-hidden"},S={class:"flex-grow-1 overflow-hidden"};function N(e,a,t,l,n,i){const r=(0,s.g2)("LayersTab");return(0,s.uX)(),(0,s.CE)("div",z,[a[0]||(a[0]=(0,s.Lk)("div",{class:"p-3"},[(0,s.Lk)("h1",{class:"my-font-size-lg my-letter-spacing-lg text-center m-3"},"GISGym")],-1)),(0,s.Lk)("div",S,[(0,s.bF)(r)])])}const A={class:"h-100 d-flex flex-column overflow-hidden my-bgcolor-gray-100"},G={class:"flex-grow-1 overflow-auto layer-list-container",ref:"layerListRef"},$={class:"mb-3"},P={class:"d-flex align-items-center pb-2"},V={class:"my-title-xs-gray"},J={class:"btn rounded-0 border-0 d-flex shadow-sm my-bgcolor-white-hover p-0"},H={class:"w-100"},B={class:"d-flex"},U=["onClick"],Q={class:"my-content-sm-black"},O={class:"my-content-xs-gray ms-2"},q=["id","checked","disabled","onChange"],Y=["for"];function Z(e,a,t,n,i,r){return(0,s.uX)(),(0,s.CE)("div",A,[(0,s.Lk)("div",G,[(0,s.Lk)("div",$,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.layers,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.groupName,class:"p-3"},[(0,s.Lk)("div",P,[(0,s.Lk)("div",V,(0,g.v_)(e.groupName),1)]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.groupLayers,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.layerId,class:"mb-1"},[(0,s.Lk)("div",J,[(0,s.Lk)("div",{class:(0,g.C4)(`my-bgcolor-${e.colorName}`),style:{"min-width":"6px"}},null,2),(0,s.Lk)("div",H,[(0,s.Lk)("div",B,[(0,s.Lk)("div",{class:"d-flex align-items-center text-start w-100 px-3 py-2 cursor-pointer",onClick:a=>n.toggleLayer(e.layerId)},[(0,s.Lk)("span",Q,[(0,s.eW)((0,g.v_)(e.layerName)+" ",1),(0,s.Lk)("span",O,(0,g.v_)(e.dashboardData?.totalCount),1)])],8,U),(0,s.Lk)("div",{class:"d-flex align-items-center justify-content-center px-3 py-2",onClick:a[0]||(a[0]=(0,l.D$)(()=>{},["stop"]))},[(0,s.Lk)("input",{type:"checkbox",id:"switch-"+e.layerId,checked:e.visible,disabled:e.isLoading,onChange:a=>n.handleToggleChange(e.layerId,a)},null,40,q),(0,s.Lk)("label",{for:"switch-"+e.layerId},null,8,Y)])])])])]))),128))]))),128))])],512)])}t(531);var ee={name:"LayersTab",setup(){const e=T(),a=(0,x.KR)(null),t=(0,s.EW)(()=>e.layers),l=a=>{e.toggleLayerVisibility(a)},n=(a,t)=>{t.stopPropagation();const l=e.layers.flatMap(e=>e.groupLayers).find(e=>e.layerId===a);l?l.visible!==t.target.checked&&e.toggleLayerVisibility(a):console.error("âŒ LayersTab: æ‰¾ä¸åˆ°åœ–å±¤",a)};return{layers:t,layerListRef:a,toggleLayer:l,handleToggleChange:n}}};const ae=(0,c.A)(ee,[["render",Z],["__scopeId","data-v-978b7824"]]);var te=ae,le={name:"LeftView",components:{LayersTab:te},setup(){return{}}};const ne=(0,c.A)(le,[["render",N]]);var se=ne;const ie={class:"my-right-panel h-100 d-flex flex-column overflow-hidden"},re={class:"d-flex justify-content-center my-bgcolor-gray-200 p-3"},oe={class:"d-flex align-items-center rounded-pill shadow my-blur gap-2 p-2 w-100"},ue=["onClick","title"],ce={class:"flex-grow-1 overflow-auto"},de={class:"h-100"},ve={class:"h-100"};function pe(e,a,t,n,i,r){const o=(0,s.g2)("LayerInfo"),u=(0,s.g2)("ControlTab");return(0,s.uX)(),(0,s.CE)("div",ie,[(0,s.Lk)("div",re,[(0,s.Lk)("div",oe,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.availableTabs,a=>((0,s.uX)(),(0,s.CE)("button",{key:a.id,class:(0,g.C4)(["btn rounded-pill border-0 my-btn-transparent my-font-size-xs text-nowrap w-100 my-cursor-pointer",{"my-btn-blue":e.$props.activeRightTab===a.id}]),onClick:e=>n.switchTab(a.id),title:a.name},(0,g.v_)(a.name),11,ue))),128))])]),(0,s.Lk)("div",ce,[(0,s.bo)((0,s.Lk)("div",de,[(0,s.bF)(o)],512),[[l.aG,"layer-info"===e.$props.activeRightTab]]),(0,s.bo)((0,s.Lk)("div",ve,[(0,s.bF)(u)],512),[[l.aG,"control"===e.$props.activeRightTab]])])])}t(1701),t(8237),t(7642),t(8004),t(3853),t(5876),t(2475),t(5024),t(1698),t(3110);const ge={chart_line:{zh:"ç·šåœ–",en:"Line Chart",icon:'<i class="fas fa-chart-line"></i>'},chart_bar:{zh:"é•·æ¢åœ–",en:"Bar Chart",icon:'<i class="fas fa-chart-bar"></i>'},spinner:{zh:"è¼‰å…¥ä¸­",en:"Loading",icon:'<i class="fas fa-spinner"></i>'},sort:{zh:"æ’åº",en:"Sort",icon:'<i class="fas fa-sort"></i>'},sort_up:{zh:"å‡åº",en:"Sort Ascending",icon:'<i class="fas fa-sort-up"></i>'},sort_down:{zh:"é™åº",en:"Sort Descending",icon:'<i class="fas fa-sort-down"></i>'},info_circle:{zh:"è³‡è¨Š",en:"Information",icon:'<i class="fas fa-info-circle"></i>'},location_dot:{zh:"ä½ç½®",en:"Location",icon:'<i class="fa-solid fa-location-dot"></i>'},map:{zh:"åœ°åœ–",en:"Map",icon:'<i class="fas fa-map"></i>'},map_marked:{zh:"æ¨™è¨˜åœ°åœ–",en:"Marked Map",icon:'<i class="fas fa-map-marked-alt"></i>'},layer_group:{zh:"åœ–å±¤",en:"Layer Group",icon:'<i class="fas fa-layer-group"></i>'},table:{zh:"è¡¨æ ¼",en:"Table",icon:'<i class="fas fa-table"></i>'},json_data:{zh:"åŸå§‹æ•¸æ“š",en:"Raw Data",icon:'<i class="fas fa-database"></i>'},draw_data:{zh:"ç¹ªè£½æ•¸æ“š",en:"Draw Data",icon:'<i class="fas fa-palette"></i>'},code:{zh:"ä»£ç¢¼",en:"Code",icon:'<i class="fas fa-code"></i>'},project_diagram:{zh:"ç¶²çµ¡åœ–",en:"Network Diagram",icon:'<i class="fas fa-project-diagram"></i>'},th:{zh:"ç¶²æ ¼",en:"Grid",icon:'<i class="fas fa-th"></i>'},file_code:{zh:"ä»£ç¢¼æ–‡ä»¶",en:"Code File",icon:'<i class="fas fa-file-code"></i>'},work:{zh:"å·¥ä½œ",en:"Work",icon:'<i class="fas fa-briefcase"></i>'}};function ye(e,a="zh"){const t=ge[e];if(!t)return{text:e,icon:"fas fa-question-circle"};const l=t.icon.match(/class="([^"]+)"/),n=l?l[1]:"fas fa-question-circle";return{text:t[a]||t.zh,icon:n}}function me(e,a=""){const t=ge[e];return t?a?t.icon.replace(/class="([^"]+)"/,`class="$1 ${a}"`):t.icon:`<i class="fas fa-question-circle${a?" "+a:""}"></i>`}const he={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},fe={key:0,class:""},be={class:"nav nav-tabs nav-fill"},ke=["onClick"],Le={key:0,class:"my-title-xs-gray"},we={class:"my-title-sm-black"},xe={key:1,class:"my-bgcolor-white h-100"},Te={class:"p-3"},Ce={key:0,class:"pb-2"},De={class:"my-content-sm-black pb-1"},Ee=["innerHTML"],_e={key:0},Re={class:"my-title-xs-gray pb-1"},Ie={class:"my-content-sm-black pb-1"},Xe={key:2,class:"pb-2"},Me={class:"my-content-sm-black pb-1"},Fe={key:0,class:"my-content-xs-gray pb-1"},Ke={key:3,class:"pb-2"},We={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var je={__name:"LayerInfoTab",setup(e){const a=T(),t=(0,x.KR)(null),l=(0,x.KR)(null),n=(0,x.KR)(!1),i=(0,s.EW)(()=>{const e=a.getAllLayers();return e.filter(e=>e.visible)}),r=e=>{t.value=e},o=e=>{if(!e)return{groupName:null,layerName:"æœªçŸ¥åœ–å±¤"};const t=a.findGroupNameByLayerId(e.layerId);return{groupName:t,layerName:e.layerName}},u=e=>{if(null===e||void 0===e)return"ç„¡è³‡æ–™";if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return String(e);if(Array.isArray(e)){if(0===e.length)return"ç©ºé™£åˆ—";const a=e.some(e=>"object"===typeof e&&null!==e);return a?e.map((e,a)=>{if("object"===typeof e&&null!==e){const t=Object.keys(e);if(t.length>0){const l=t[0];return`${a+1}: ${l}=${e[l]}`}return`${a+1}: ç‰©ä»¶`}return String(e)}).join(", "):e.join(", ")}if("object"===typeof e){const a=Object.keys(e);if(0===a.length)return"ç©ºç‰©ä»¶";if(a.length<=3)return a.map(a=>`${a}: ${e[a]}`).join(", ");const t=a.slice(0,2);return t.map(a=>`${a}: ${e[a]}`).join(", ")+` ... (å…± ${a.length} å€‹å±¬æ€§)`}return String(e)},c=(0,s.EW)(()=>{if(!t.value)return[];const e=i.value.find(e=>e.layerId===t.value);if(!e)return[];const a=["layerId","layerName","visible","isLoading","isLoaded","colorName","jsonData","geojsonData","processedJsonData","drawJsonData","dashboardData","dataTableData","layerInfoData","jsonLoader","geojsonLoader","processToDrawData","geojsonFileName","jsonFileName","executeFunction","display","upperViewTabs"],l=new Set(["jsonData","geojsonData","processedJsonData","drawJsonData","dashboardData","dataTableData","layerInfoData","jsonLoader","geojsonLoader","processToDrawData","executeFunction"]);return a.filter(a=>a in e).map(a=>{let t=e[a];return l.has(a)?t=null!==t&&void 0!==t?"V":"X":"function"===typeof t&&(t=t.name||"åŒ¿åå‡½æ•¸"),[a,t]})}),d=(0,x.KR)([]);(0,s.wB)(()=>i.value,e=>{if(0===e.length)return t.value=null,l.value=null,void(d.value=[]);const a=d.value.map(e=>e.layerId),n=e.map(e=>e.layerId),s=n.filter(e=>!a.includes(e));if(s.length>0){const e=s[s.length-1];t.value=e}else t.value&&e.find(e=>e.layerId===t.value)||(t.value=e[0].layerId);d.value=[...e]},{deep:!0,immediate:!0});const v=async e=>{const a=e&&(e.geojsonData||e.processedJsonData);if(a){n.value=!0;try{await new Promise(e=>setTimeout(e,500));const a=e.geojsonData||(e.processedJsonData&&e.processedJsonData.features?e.processedJsonData:null);if(!a||!a.features)throw new Error("åœ–å±¤æ²’æœ‰æœ‰æ•ˆçš„ GeoJSON æ•¸æ“š");const t=a.features,n={totalFeatures:t.length,totalPopulation:t.reduce((e,a)=>e+(a.properties.P_CNT||0),0),totalCount:t.reduce((e,a)=>e+(a.properties.count||0),0),avgPopulation:0,avgCount:0};n.totalFeatures>0&&(n.avgPopulation=n.totalPopulation/n.totalFeatures,n.avgCount=n.totalCount/n.totalFeatures),l.value={layerName:e.layerName,timestamp:(new Date).toLocaleString(),statistics:n}}catch(t){console.error("è¼‰å…¥åœ–å±¤è³‡è¨Šå¤±æ•—:",t),l.value={error:"è¼‰å…¥éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤",details:t.message}}finally{n.value=!1}}else console.warn("ç„¡æ³•è¼‰å…¥è³‡è¨Šï¼šåœ–å±¤æ•¸æ“šä¸å­˜åœ¨")};return(0,s.wB)(()=>t.value,e=>{if(e){const t=a.findLayerById(e);t&&t.processedJsonData&&v(t)}else l.value=null},{immediate:!0}),(0,s.wB)(()=>{if(!t.value)return null;const e=i.value.find(e=>e.layerId===t.value);return e?e.processedJsonData:null},e=>{},{deep:!0}),(0,s.wB)(()=>{if(!t.value)return null;const e=i.value.find(e=>e.layerId===t.value);if(!e)return null;const a=e.layerId?.startsWith("taipei_");return a?e.layoutGridJsonData||e.spaceNetworkGridJsonData:e.layoutGridJsonData||e.spaceNetworkGridJsonData||e.jsonData},()=>{},{deep:!0,immediate:!0}),(0,s.sV)(()=>{i.value.length>0&&!t.value&&(t.value=i.value[0].layerId)}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",he,[i.value.length>0?((0,s.uX)(),(0,s.CE)("div",fe,[(0,s.Lk)("ul",be,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,s.Lk)("div",{class:(0,g.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:t.value===e.layerId}]),onClick:a=>r(e.layerId)},[(0,s.Lk)("span",null,[o(e).groupName?((0,s.uX)(),(0,s.CE)("span",Le,(0,g.v_)(o(e).groupName)+" - ",1)):(0,s.Q3)("",!0),(0,s.Lk)("span",we,(0,g.v_)(o(e).layerName),1)])],10,ke),(0,s.Lk)("div",{class:(0,g.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)]))),128))])])):(0,s.Q3)("",!0),i.value.length>0?((0,s.uX)(),(0,s.CE)("div",xe,[(0,s.Lk)("div",null,[(0,s.Lk)("div",Te,[n.value?((0,s.uX)(),(0,s.CE)("div",Ce,[a[1]||(a[1]=(0,s.Lk)("div",{class:"my-title-xs-gray pb-1"},"è¼‰å…¥ç‹€æ…‹",-1)),(0,s.Lk)("div",De,[(0,s.Lk)("span",{innerHTML:(0,x.R1)(me)("spinner","fa-spin me-2")},null,8,Ee),a[0]||(a[0]=(0,s.eW)(" æ­£åœ¨è¼‰å…¥åœ–å±¤è³‡è¨Š... ",-1))])])):(0,s.Q3)("",!0),i.value.length>0&&c.value.length>0?((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[c.value.length>0?((0,s.uX)(),(0,s.CE)("div",_e,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(c.value,([e,a])=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"pb-2"},[(0,s.Lk)("div",Re,(0,g.v_)(e),1),(0,s.Lk)("div",Ie,(0,g.v_)(u(a)),1)]))),128))])):(0,s.Q3)("",!0)],64)):l.value&&l.value.error?((0,s.uX)(),(0,s.CE)("div",Xe,[a[2]||(a[2]=(0,s.Lk)("div",{class:"my-title-xs-gray pb-1"},"è¼‰å…¥éŒ¯èª¤",-1)),(0,s.Lk)("div",Me,(0,g.v_)(l.value.error),1),l.value.details?((0,s.uX)(),(0,s.CE)("div",Fe," è©³ç´°ä¿¡æ¯ï¼š"+(0,g.v_)(l.value.details),1)):(0,s.Q3)("",!0)])):n.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Ke,[...a[3]||(a[3]=[(0,s.Lk)("div",{class:"my-title-xs-gray pb-1"},"è¼‰å…¥ç‹€æ…‹",-1),(0,s.Lk)("div",{class:"my-content-sm-black pb-1"},"ç­‰å¾…åœ–å±¤æ•¸æ“šè¼‰å…¥...",-1)])]))])])])):((0,s.uX)(),(0,s.CE)("div",We,[...a[4]||(a[4]=[(0,s.Lk)("div",{class:"text-center"},[(0,s.Lk)("div",{class:"my-title-md-gray p-3"},"æ²’æœ‰é–‹å•Ÿçš„åœ–å±¤")],-1)])]))]))}};const ze=je;var Se=ze;const Ne={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Ae={key:0,class:""},Ge={class:"nav nav-tabs nav-fill"},$e=["onClick"],Pe={class:"my-title-sm-black"},Ve={key:0,class:"my-title-xs-gray"},Je={key:1,class:"flex-grow-1 overflow-auto p-3 my-bgcolor-white"},He={key:0,class:"rag-card"},Be={key:0,class:"rag-file-info"},Ue={class:"rag-question-area"},Qe=["disabled"],Oe={key:0,class:"rag-loader"},qe={key:2,class:"rag-result"},Ye={class:"rag-result-section"},Ze={class:"rag-result-content"},ea={class:"rag-result-section"},aa={class:"rag-result-content"},ta={key:0,class:"rag-result-section"},la={class:"rag-result-sources"},na={key:1,class:"pb-3 mb-3"},sa={key:2,class:"d-flex align-items-center justify-content-center h-100"},ia="https://kevin7261-gisgym.hf.space/ask_with_zip";var ra={__name:"ControlTab",setup(e){const a=T(),t=(0,x.KR)(null),n=(0,x.KR)(null),i=(0,x.KR)(null),r=(0,x.KR)(""),o=(0,x.KR)(!1),u=(0,x.KR)(""),c=(0,x.KR)(""),d=(0,x.KR)(!1),v=(0,x.KR)(""),p=(0,x.KR)(""),y=(0,x.KR)([]),m=(0,s.EW)(()=>{const e=a.getAllLayers();return e.filter(e=>e&&e.visible)}),h=(0,s.EW)(()=>m.value.filter(e=>e&&e.layerId)),f=(0,s.EW)(()=>t.value&&m.value&&0!==m.value.length&&m.value.find(e=>e&&e.layerId===t.value)||null),b=e=>{if(!e)return{groupName:null,layerName:"æœªçŸ¥åœ–å±¤"};const t=a.findGroupNameByLayerId(e.layerId);return{groupName:t,layerName:e.layerName}},k=e=>{t.value=e},L=(0,s.EW)(()=>d.value?"æ”¾é–‹ä»¥ä¸Šå‚³æª”æ¡ˆ":"é»æ“Šæˆ–æ‹–æ›³ ZIP æª”æ¡ˆè‡³æ­¤"),w=(0,s.EW)(()=>o.value?"é›²ç«¯é‹ç®—ä¸­...":"ä¸Šå‚³ä¸¦æå•"),C=(0,s.EW)(()=>`rag-status-${c.value}`),D=()=>{v.value="",p.value="",y.value=[],u.value=""},E=e=>{const a=e.target.files;a&&a.length>0&&(i.value=a[0],D())},_=()=>{d.value=!0},R=()=>{d.value=!1},I=e=>{d.value=!1;const a=e.dataTransfer.files;a&&a.length>0&&(i.value=a[0],D())},X=async()=>{if(!i.value)return void alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ rag_db.zip æª”æ¡ˆï¼");if(!r.value)return void alert("è«‹è¼¸å…¥å•é¡Œå…§å®¹ï¼");const e=i.value;if("application/zip"===e.type||e.name.endsWith(".zip")){D(),o.value=!0,c.value="info",u.value="ğŸš€ æ­£åœ¨ä¸Šå‚³è³‡æ–™åº«ä¸¦æå•...é€™å¯èƒ½éœ€è¦ä¸€é»æ™‚é–“ï¼Œè«‹å‹¿é—œé–‰è¦–çª—ã€‚";try{const e=new FormData;e.append("file",i.value),e.append("question",r.value);const a=await fetch(ia,{method:"POST",body:e});if(!a.ok){const e=await a.text();throw new Error(`ä¼ºæœå™¨éŒ¯èª¤: ${a.status} - ${e}`)}const t=await a.json();v.value=t.question||r.value,p.value=t.answer||"",y.value=Array.isArray(t.sources)?t.sources:[],c.value="success",u.value="âœ… æˆåŠŸï¼å·²å–å¾— AI å›ç­”ã€‚"}catch(a){c.value="error",u.value=`âŒ ç™¼ç”ŸéŒ¯èª¤: ${a.message}`}finally{o.value=!1}}else alert("éŒ¯èª¤ï¼šåƒ…æ”¯æ´ .zip æ ¼å¼çš„å£“ç¸®æª”")},M=(0,x.KR)([]);return(0,s.wB)(()=>m.value,e=>{if(!Array.isArray(e))return t.value=null,void(M.value=[]);if(0===e.length)return t.value=null,void(M.value=[]);const a=e.filter(e=>e&&e.layerId);if(0===a.length)return t.value=null,void(M.value=[]);(0,s.dY)(()=>{const e=(M.value||[]).filter(e=>e&&e.layerId).map(e=>e.layerId),l=a.map(e=>e.layerId),n=l.filter(a=>!e.includes(a));if(n.length>0){const e=n[n.length-1];a.find(a=>a.layerId===e)&&(t.value=e)}else t.value&&a.find(e=>e.layerId===t.value)||a[0]&&a[0].layerId&&(t.value=a[0].layerId);M.value=[...a]})},{deep:!1,immediate:!0}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",Ne,[m.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ae,[(0,s.Lk)("ul",Ge,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,s.Lk)("div",{class:(0,g.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:t.value===e.layerId}]),onClick:a=>k(e.layerId)},[(0,s.Lk)("span",Pe,[b(e).groupName?((0,s.uX)(),(0,s.CE)("span",Ve,(0,g.v_)(b(e).groupName)+" - ",1)):(0,s.Q3)("",!0),(0,s.Lk)("span",null,(0,g.v_)(b(e).layerName),1)])],10,$e),(0,s.Lk)("div",{class:(0,g.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)]))),128))])])):(0,s.Q3)("",!0),m.value.length>0?((0,s.uX)(),(0,s.CE)("div",Je,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(h.value,e=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",{key:e.layerId},["test_layer"===e.layerId?((0,s.uX)(),(0,s.CE)("div",He,[a[6]||(a[6]=(0,s.Lk)("h3",{class:"rag-title"},"â“ ä¸Šå‚³ RAG è³‡æ–™åº«å•å•é¡Œ",-1)),a[7]||(a[7]=(0,s.Lk)("p",{class:"rag-description"},[(0,s.eW)(" è«‹ä¸Šå‚³å‰›å‰›ä¸‹è¼‰çš„ "),(0,s.Lk)("strong",null,"rag_db.zip"),(0,s.eW)("ï¼Œä¸¦è¼¸å…¥æ‚¨çš„å•é¡Œï¼Œç³»çµ±æœƒå›å‚³ AI å›ç­”èˆ‡ä¾†æºæª”æ¡ˆã€‚ ")],-1)),a[8]||(a[8]=(0,s.Lk)("div",{class:"rag-tip"},[(0,s.eW)(" ğŸ’¡ "),(0,s.Lk)("strong",null,"æç¤ºï¼š"),(0,s.eW)("è«‹ä¸Šå‚³ "),(0,s.Lk)("strong",null,"rag_db.zip"),(0,s.eW)("ï¼ˆä¸è¦å‚³åŸå§‹ PDFï¼‰ï¼Œå•é¡Œå¯è¼¸å…¥å¦‚ã€Œé€™ä»½æ–‡ä»¶çš„çµè«–æ˜¯ä»€éº¼ï¼Ÿã€ã€‚ ")],-1)),(0,s.Lk)("div",{class:(0,g.C4)(["rag-upload-area",{"rag-drag-over":d.value}]),onClick:a[0]||(a[0]=e=>n.value&&n.value.click()),onDragover:(0,l.D$)(_,["prevent"]),onDragleave:(0,l.D$)(R,["prevent"]),onDrop:(0,l.D$)(I,["prevent"])},[(0,s.Lk)("input",{ref_for:!0,ref_key:"ragFileInput",ref:n,type:"file",accept:".zip",onChange:E,style:{display:"none"}},null,544),(0,s.Lk)("span",null,(0,g.v_)(L.value),1)],34),i.value?((0,s.uX)(),(0,s.CE)("div",Be," ğŸ“¦ å·²é¸æ“‡: "+(0,g.v_)(i.value.name),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",Ue,[a[2]||(a[2]=(0,s.Lk)("label",{class:"rag-question-label",for:"rag-question-input"},"å•é¡Œ",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"rag-question-input",class:"rag-question-input",rows:"4",placeholder:"ä¾‹å¦‚ï¼šé€™ä»½æ–‡ä»¶çš„çµè«–æ˜¯ä»€éº¼ï¼Ÿ","onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),onInput:D},null,544),[[l.Jo,r.value,void 0,{trim:!0}]])]),(0,s.Lk)("button",{class:"rag-submit-btn",onClick:X,disabled:!i.value||!r.value||o.value},[o.value?((0,s.uX)(),(0,s.CE)("span",Oe)):(0,s.Q3)("",!0),(0,s.Lk)("span",null,(0,g.v_)(w.value),1)],8,Qe),u.value?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,g.C4)(["rag-status",C.value])},(0,g.v_)(u.value),3)):(0,s.Q3)("",!0),p.value?((0,s.uX)(),(0,s.CE)("div",qe,[(0,s.Lk)("div",Ye,[a[3]||(a[3]=(0,s.Lk)("div",{class:"rag-result-title"},"å•é¡Œ",-1)),(0,s.Lk)("div",Ze,(0,g.v_)(v.value),1)]),(0,s.Lk)("div",ea,[a[4]||(a[4]=(0,s.Lk)("div",{class:"rag-result-title"},"å›ç­”",-1)),(0,s.Lk)("div",aa,(0,g.v_)(p.value),1)]),y.value.length?((0,s.uX)(),(0,s.CE)("div",ta,[a[5]||(a[5]=(0,s.Lk)("div",{class:"rag-result-title"},"ä¾†æº",-1)),(0,s.Lk)("ul",la,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e},(0,g.v_)(e),1))),128))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),a[9]||(a[9]=(0,s.Lk)("div",{class:"rag-note"},[(0,s.eW)(" âš ï¸ "),(0,s.Lk)("strong",null,"æ³¨æ„ï¼š"),(0,s.Lk)("br"),(0,s.eW)(" 1. æª”æ¡ˆå¤§å°è«‹å‹¿éå¤§ï¼Œä»¥å…é€£ç·šé€¾æ™‚ã€‚"),(0,s.Lk)("br"),(0,s.eW)(" 2. è‹¥ Hugging Face ä¸»æ©Ÿä¼‘çœ ä¸­ï¼Œé¦–æ¬¡åŸ·è¡Œå¯èƒ½éœ€ç­‰å¾… 1-3 åˆ†é˜å–šé†’ã€‚ ")],-1))])):f.value?((0,s.uX)(),(0,s.CE)("div",na,[...a[10]||(a[10]=[(0,s.Lk)("div",{class:"my-title-md-gray text-center p-3"},"æ­¤åœ–å±¤ç›®å‰æ²’æœ‰å¯ç”¨çš„æ“ä½œ",-1)])])):(0,s.Q3)("",!0)])),[[l.aG,t.value===e.layerId]])),128))])):((0,s.uX)(),(0,s.CE)("div",sa,[...a[11]||(a[11]=[(0,s.Lk)("div",{class:"my-title-md-gray text-center p-3"},"æ²’æœ‰é–‹å•Ÿçš„åœ–å±¤",-1)])]))]))}};const oa=(0,c.A)(ra,[["__scopeId","data-v-36b88c5e"]]);var ua=oa,ca={name:"RightView",components:{LayerInfo:Se,ControlTab:ua},props:{activeRightTab:{type:String,default:"layer-info"},analysisList:{type:Array,default:()=>[]},selectedAnalysisId:{type:[Number,String],default:null},rightViewWidth:{type:Number,default:250}},emits:["update:activeRightTab","select-analysis","view-analysis","delete-analysis","highlight-feature"],setup(e,{emit:a}){const t=T(),l=[{id:"layer-info",name:"åœ–å±¤",icon:ye("info_circle").icon},{id:"control",name:"æ“ä½œ",icon:ye("play").icon}],n=e=>{a("update:activeRightTab",e)},i=()=>e.analysisList.filter(e=>"å®Œæˆ"===e.status).length;(0,s.wB)(()=>t.selectedFeature,()=>{},{immediate:!0});const r=(0,s.EW)(()=>{const e=t.selectedFeature;return e});return{availableTabs:l,switchTab:n,getActiveAnalysisCount:i,selectedFeature:r}}};const da=(0,c.A)(ca,[["render",pe]]);var va=da;const pa={class:"d-flex flex-column h-100 overflow-hidden"},ga={class:"d-flex justify-content-start my-bgcolor-gray-200 p-3"},ya={class:"d-flex align-items-center rounded-pill shadow my-blur gap-1 p-2"},ma=["disabled"],ha=["disabled"],fa={class:"flex-grow-1 overflow-auto my-bgcolor-gray-200"},ba={key:0,class:"h-100 d-flex align-items-center justify-content-center"},ka={ref:"dashboardContainerRef",class:"h-100"},La={ref:"workContainerRef",class:"h-100"};function wa(e,a,t,n,i,r){const o=(0,s.g2)("DashboardTab"),u=(0,s.g2)("WorkTab");return(0,s.uX)(),(0,s.CE)("div",pa,[(0,s.Lk)("div",ga,[(0,s.Lk)("div",ya,[(0,s.Lk)("button",{class:(0,g.C4)(["btn rounded-circle border-0 d-flex align-items-center justify-content-center my-btn-transparent my-font-size-xs",{"my-btn-blue":"work"===t.activeUpperTab}]),disabled:!n.isTabEnabled["work"],onClick:a[0]||(a[0]=a=>e.$emit("update:activeUpperTab","work")),title:"å·¥ä½œ",style:{width:"30px",height:"30px"}},[(0,s.Lk)("i",{class:(0,g.C4)(n.getIcon("work").icon)},null,2)],10,ma),(0,s.Lk)("button",{class:(0,g.C4)(["btn rounded-circle border-0 d-flex align-items-center justify-content-center my-btn-transparent my-font-size-xs",{"my-btn-blue":"dashboard"===t.activeUpperTab}]),disabled:!n.isTabEnabled["dashboard"],onClick:a[1]||(a[1]=a=>e.$emit("update:activeUpperTab","dashboard")),title:"è³‡æ–™å„€è¡¨æ¿",style:{width:"30px",height:"30px"}},[(0,s.Lk)("i",{class:(0,g.C4)(n.getIcon("chart_bar").icon)},null,2)],10,ha)])]),(0,s.Lk)("div",fa,[n.hasVisibleLayers?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",ba,[...a[2]||(a[2]=[(0,s.Lk)("div",{class:"text-center"},[(0,s.Lk)("div",{class:"my-title-md-gray"},"æ²’æœ‰é–‹å•Ÿçš„åœ–å±¤")],-1)])])),(0,s.bo)((0,s.Lk)("div",ka,[(0,s.bF)(o,{ref:"DashboardTab",containerHeight:t.contentHeight,isPanelDragging:t.isPanelDragging,activeMarkers:t.activeMarkers,onActiveLayerChange:n.handleActiveLayerChange},null,8,["containerHeight","isPanelDragging","activeMarkers","onActiveLayerChange"])],512),[[l.aG,n.hasVisibleLayers&&"dashboard"===t.activeUpperTab]]),(0,s.bo)((0,s.Lk)("div",La,[(0,s.bF)(u,{ref:"WorkTab",containerHeight:t.contentHeight,isPanelDragging:t.isPanelDragging,activeMarkers:t.activeMarkers,onActiveLayerChange:n.handleActiveLayerChange},null,8,["containerHeight","isPanelDragging","activeMarkers","onActiveLayerChange"])],512),[[l.aG,n.hasVisibleLayers&&"work"===t.activeUpperTab]])])])}const xa={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Ta={key:0,class:""},Ca={class:"nav nav-tabs nav-fill"},Da=["onClick"],Ea={key:0,class:"my-title-xs-gray"},_a={class:"my-title-sm-black"},Ra={key:1,class:"flex-grow-1 overflow-auto my-bgcolor-white p-3"},Ia={class:"mb-4"},Xa={class:"my-title-md-black"},Ma={key:0},Fa={class:"my-title-xs-gray pb-1"},Ka={class:"my-content-sm-black pb-1"},Wa={key:1,class:"text-center py-5"},ja={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var za={__name:"DashboardTab",emits:["active-layer-change"],setup(e,{emit:a}){const t=T(),l=(0,x.KR)(null),n=a,i=(0,s.EW)(()=>{const e=t.getAllLayers();return e.filter(e=>e.visible)}),r=e=>{l.value=e,n("active-layer-change",l.value)},o=(0,s.EW)(()=>{if(!l.value)return null;const e=i.value.find(e=>e.layerId===l.value);return e&&e.dashboardData||null}),u=(0,s.EW)(()=>{if(!l.value)return"ç„¡é–‹å•Ÿåœ–å±¤";const e=i.value.find(e=>e.layerId===l.value);return e?e.layerName||"æœªçŸ¥åœ–å±¤":"ç„¡é–‹å•Ÿåœ–å±¤"}),c=e=>{if(!e)return{groupName:null,layerName:"æœªçŸ¥åœ–å±¤"};const a=t.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},d=e=>{if(null===e||void 0===e)return"ç„¡è³‡æ–™";if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return String(e);if(Array.isArray(e)){if(0===e.length)return"ç©ºé™£åˆ—";const a=e.some(e=>"object"===typeof e&&null!==e);return a?e.map((e,a)=>{if("object"===typeof e&&null!==e){const t=Object.keys(e);if(t.length>0){const l=t[0];return`${a+1}: ${l}=${e[l]}`}return`${a+1}: ç‰©ä»¶`}return String(e)}).join(", "):e.join(", ")}if("object"===typeof e){const a=Object.keys(e);if(0===a.length)return"ç©ºç‰©ä»¶";if(a.length<=3)return a.map(a=>`${a}: ${e[a]}`).join(", ");const t=a.slice(0,2);return t.map(a=>`${a}: ${e[a]}`).join(", ")+` ... (å…± ${a.length} å€‹å±¬æ€§)`}return String(e)},v=(0,s.EW)(()=>o.value?Object.entries(o.value):[]),p=(0,x.KR)([]);return(0,s.wB)(()=>i.value,e=>{if(0===e.length)return l.value=null,void(p.value=[]);const a=p.value.map(e=>e.layerId),t=e.map(e=>e.layerId),s=t.filter(e=>!a.includes(e));if(s.length>0){const e=s[s.length-1];l.value=e,n("active-layer-change",l.value)}else l.value&&e.find(e=>e.layerId===l.value)||(l.value=e[0].layerId,n("active-layer-change",l.value));p.value=[...e]},{deep:!0,immediate:!0}),(0,s.sV)(()=>{i.value.length>0&&!l.value&&(l.value=i.value[0].layerId,n("active-layer-change",l.value))}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",xa,[i.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ta,[(0,s.Lk)("ul",Ca,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,s.Lk)("div",{class:(0,g.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:l.value===e.layerId}]),onClick:a=>r(e.layerId)},[(0,s.Lk)("span",null,[c(e).groupName?((0,s.uX)(),(0,s.CE)("span",Ea,(0,g.v_)(c(e).groupName)+" - ",1)):(0,s.Q3)("",!0),(0,s.Lk)("span",_a,(0,g.v_)(c(e).layerName),1)])],10,Da),(0,s.Lk)("div",{class:(0,g.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)]))),128))])])):(0,s.Q3)("",!0),i.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ra,[(0,s.Lk)("div",Ia,[(0,s.Lk)("h5",Xa,(0,g.v_)(u.value),1)]),o.value&&v.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ma,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.value,([e,a])=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"mb-3"},[(0,s.Lk)("div",Fa,(0,g.v_)(e),1),(0,s.Lk)("div",Ka,(0,g.v_)(d(a)),1)]))),128))])):o.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",Wa,[...a[0]||(a[0]=[(0,s.Lk)("div",{class:"my-title-md-gray"},"æ­¤åœ–å±¤æ²’æœ‰å¯ç”¨çš„å„€è¡¨æ¿è³‡è¨Š",-1)])]))])):((0,s.uX)(),(0,s.CE)("div",ja,[...a[1]||(a[1]=[(0,s.Lk)("div",{class:"text-center"},[(0,s.Lk)("div",{class:"my-title-md-gray p-3"},"æ²’æœ‰é–‹å•Ÿçš„åœ–å±¤")],-1)])]))]))}};const Sa=za;var Na=Sa;const Aa={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},Ga={key:0,class:""},$a={class:"nav nav-tabs nav-fill"},Pa=["onClick"],Va={key:0,class:"my-title-xs-gray"},Ja={class:"my-title-sm-black"},Ha={key:1,class:"flex-grow-1 overflow-auto my-bgcolor-white p-3"},Ba={key:0,class:"ai-assistant-container"},Ua={class:"ai-section mb-4 p-3 border rounded"},Qa={class:"mb-3"},Oa={key:0,class:"text-muted"},qa={key:1,class:"text-muted"},Ya={class:"row g-3 mb-3"},Za={class:"col-md-6"},et={class:"col-md-6"},at=["disabled"],tt={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},lt={key:0,class:"ai-section mb-4 p-3 border rounded"},nt={class:"result-box p-3 mb-3 bg-light rounded"},st={class:"question-content mb-3"},it={class:"mb-1"},rt={class:"mb-0"},ot={class:"mb-3"},ut=["disabled"],ct={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},dt={key:1,class:"ai-section mb-4 p-3 border rounded"},vt={class:"result-box p-3 bg-light rounded"},pt={class:"d-flex justify-content-between align-items-center mb-3"},gt={class:"score-badge"},yt={class:"level-badge"},mt={key:0,class:"mb-3"},ht={class:"mb-0"},ft={key:1,class:"mb-3"},bt={class:"mb-0"},kt={key:2,class:"mb-3"},Lt={class:"mb-0"},wt={key:3,class:"mb-0"},xt={class:"mb-0"},Tt={key:1},Ct={class:"mb-4"},Dt={class:"my-title-md-black"},Et={key:0},_t={class:"my-title-xs-gray pb-1"},Rt={class:"my-content-sm-black pb-1"},It={key:1,class:"text-center py-5"},Xt={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var Mt={__name:"WorkTab",props:{containerHeight:{type:Number,default:600},isPanelDragging:{type:Boolean,default:!1},activeMarkers:{type:Number,default:0}},emits:["active-layer-change"],setup(e,{emit:a}){const t=T(),n=(0,x.KR)(null),i=a,r=e=>{n.value=e,i("active-layer-change",n.value)},o=(0,s.EW)(()=>{const e=t.getAllLayers();return e.filter(e=>e.visible)}),u=(0,x.KR)([]),c=(0,s.EW)(()=>{if(!n.value)return null;const e=o.value.find(e=>e.layerId===n.value);return e&&e.workData||null}),d=(0,s.EW)(()=>{if(!n.value)return"ç„¡é–‹å•Ÿåœ–å±¤";const e=o.value.find(e=>e.layerId===n.value);return e?e.layerName||"æœªçŸ¥åœ–å±¤":"ç„¡é–‹å•Ÿåœ–å±¤"}),v=e=>{if(!e)return{groupName:null,layerName:"æœªçŸ¥åœ–å±¤"};const a=t.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},p=e=>{if(null===e||void 0===e)return"ç„¡è³‡æ–™";if("string"===typeof e||"number"===typeof e||"boolean"===typeof e)return String(e);if(Array.isArray(e)){if(0===e.length)return"ç©ºé™£åˆ—";const a=e.some(e=>"object"===typeof e&&null!==e);return a?e.map((e,a)=>{if("object"===typeof e&&null!==e){const t=Object.keys(e);if(t.length>0){const l=t[0];return`${a+1}: ${l}=${e[l]}`}return`${a+1}: ç‰©ä»¶`}return String(e)}).join(", "):e.join(", ")}if("object"===typeof e){const a=Object.keys(e);if(0===a.length)return"ç©ºç‰©ä»¶";if(a.length<=3)return a.map(a=>`${a}: ${e[a]}`).join(", ");const t=a.slice(0,2);return t.map(a=>`${a}: ${e[a]}`).join(", ")+` ... (å…± ${a.length} å€‹å±¬æ€§)`}return String(e)},y=(0,s.EW)(()=>c.value?Object.entries(c.value):[]);(0,s.wB)(()=>o.value,e=>{if(0===e.length)return n.value=null,void(u.value=[]);const a=u.value.map(e=>e.layerId),t=e.map(e=>e.layerId),l=t.filter(e=>!a.includes(e));if(l.length>0){const e=l[l.length-1];n.value=e,i("active-layer-change",n.value)}else n.value&&e.find(e=>e.layerId===n.value)||(n.value=e[0].layerId,i("active-layer-change",n.value));u.value=[...e]},{deep:!0,immediate:!0}),(0,s.sV)(()=>{o.value.length>0&&!n.value&&(n.value=o.value[0].layerId,i("active-layer-change",n.value))});const m=(0,s.EW)(()=>"test_layer"===n.value),h=(0,x.KR)("https://kevin7261-gisgym.hf.space"),f=(0,x.KR)(null),b=(0,x.KR)("å¯¦ä½œé¡Œ"),k=(0,x.KR)("é€²éš"),L=(0,x.KR)(!1),w=(0,x.KR)(null),C=(0,x.KR)(""),D=(0,x.KR)(""),E=(0,x.KR)(""),_=(0,x.KR)(""),R=(0,x.KR)(!1),I=(0,x.KR)(null),X=e=>{const a=e.target.files[0];a&&(f.value=a)},M=async()=>{L.value=!0,w.value=null,C.value="",D.value="",E.value="",I.value=null,_.value="";try{const e=new FormData;f.value&&e.append("file",f.value),e.append("qtype",b.value),e.append("level",k.value);const a=await fetch(`${h.value}/api/generate_question`,{method:"POST",body:e});if(!a.ok){const e=await a.text();throw new Error(e||`HTTP ${a.status}: ${a.statusText}`)}const t=await a.json();w.value=t,C.value=t.question_content||"",D.value=t.hint||"",E.value=t.target_filename||""}catch(e){console.error("å‡ºé¡Œå¤±æ•—:",e);let a=e.message;"Failed to fetch"===e.message||"TypeError"===e.name?a=`ç„¡æ³•é€£æ¥åˆ° API ä¼ºæœå™¨ (${h.value})\n\nå¯èƒ½çš„åŸå› ï¼š\n1. API ä¼ºæœå™¨æœªå•Ÿå‹•ï¼ˆè«‹ç¢ºèªå¾Œç«¯æœå‹™æ˜¯å¦é‹è¡Œåœ¨ ${h.value}ï¼‰\n2. CORS è·¨åŸŸå•é¡Œï¼ˆè«‹æª¢æŸ¥å¾Œç«¯æ˜¯å¦å…è¨±ä¾†è‡ª ${window.location.origin} çš„è«‹æ±‚ï¼‰\n3. ç¶²è·¯é€£æ¥å•é¡Œ\n\næç¤ºï¼šå¦‚æœ API ä¼ºæœå™¨é‹è¡Œåœ¨ä¸åŒçš„åœ°å€ï¼Œè«‹ä¿®æ”¹ API_BASE è¨­å®šã€‚`:(e.message.includes("NetworkError")||e.message.includes("network"))&&(a="ç¶²è·¯éŒ¯èª¤ï¼šç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨\n\nè«‹ç¢ºèªï¼š\n1. API ä¼ºæœå™¨æ˜¯å¦æ­£åœ¨é‹è¡Œ\n2. ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸"),alert(`å‡ºé¡Œå¤±æ•—ï¼š${a}`)}finally{L.value=!1}},F=async()=>{if(_.value.trim())if(C.value){R.value=!0,I.value=null;try{const e=new FormData;f.value&&e.append("file",f.value),e.append("question_text",C.value),e.append("student_answer",_.value),e.append("qtype",b.value);const a=await fetch(`${h.value}/api/grade_submission`,{method:"POST",body:e});if(!a.ok){const e=await a.text();throw new Error(e||`HTTP ${a.status}: ${a.statusText}`)}const t=await a.json();I.value=t}catch(e){console.error("è©•åˆ†å¤±æ•—:",e);let a=e.message;"Failed to fetch"===e.message||"TypeError"===e.name?a=`ç„¡æ³•é€£æ¥åˆ° API ä¼ºæœå™¨ (${h.value})\n\nå¯èƒ½çš„åŸå› ï¼š\n1. API ä¼ºæœå™¨æœªå•Ÿå‹•ï¼ˆè«‹ç¢ºèªå¾Œç«¯æœå‹™æ˜¯å¦é‹è¡Œåœ¨ ${h.value}ï¼‰\n2. CORS è·¨åŸŸå•é¡Œï¼ˆè«‹æª¢æŸ¥å¾Œç«¯æ˜¯å¦å…è¨±ä¾†è‡ª ${window.location.origin} çš„è«‹æ±‚ï¼‰\n3. ç¶²è·¯é€£æ¥å•é¡Œ\n\næç¤ºï¼šå¦‚æœ API ä¼ºæœå™¨é‹è¡Œåœ¨ä¸åŒçš„åœ°å€ï¼Œè«‹ä¿®æ”¹ API_BASE è¨­å®šã€‚`:(e.message.includes("NetworkError")||e.message.includes("network"))&&(a="ç¶²è·¯éŒ¯èª¤ï¼šç„¡æ³•é€£æ¥åˆ°ä¼ºæœå™¨\n\nè«‹ç¢ºèªï¼š\n1. API ä¼ºæœå™¨æ˜¯å¦æ­£åœ¨é‹è¡Œ\n2. ç¶²è·¯é€£æ¥æ˜¯å¦æ­£å¸¸"),alert(`è©•åˆ†å¤±æ•—ï¼š${a}`)}finally{R.value=!1}}else alert("è«‹å…ˆç”Ÿæˆé¡Œç›®ï¼");else alert("è«‹è¼¸å…¥ç­”æ¡ˆå¾Œå†é€å‡ºï¼")};return(e,a)=>((0,s.uX)(),(0,s.CE)("div",Aa,[o.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ga,[(0,s.Lk)("ul",$a,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,s.Lk)("div",{class:(0,g.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:n.value===e.layerId}]),onClick:a=>r(e.layerId)},[(0,s.Lk)("span",null,[v(e).groupName?((0,s.uX)(),(0,s.CE)("span",Va,(0,g.v_)(v(e).groupName)+" - ",1)):(0,s.Q3)("",!0),(0,s.Lk)("span",Ja,(0,g.v_)(v(e).layerName),1)])],10,Pa),(0,s.Lk)("div",{class:(0,g.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)]))),128))])])):(0,s.Q3)("",!0),o.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ha,[m.value?((0,s.uX)(),(0,s.CE)("div",Ba,[a[23]||(a[23]=(0,s.Lk)("h5",{class:"my-title-md-black mb-4"},"ğŸ“ AI ç©ºé–“åˆ†æåŠ©æ•™ (RAG ç‰ˆ)",-1)),(0,s.Lk)("div",Ua,[a[8]||(a[8]=(0,s.Lk)("h6",{class:"my-title-sm-black mb-3"},"1. ä¸Šå‚³ RAG è³‡æ–™åº«èˆ‡è¨­å®š",-1)),(0,s.Lk)("div",Qa,[a[3]||(a[3]=(0,s.Lk)("label",{class:"form-label my-title-xs-gray"},"è«‹é¸æ“‡æ‚¨çš„ rag.zip æˆ– åŸå§‹è¬›ç¾©.zipï¼ˆé¸å¡«ï¼Œä¸é¸æ“‡å‰‡ä½¿ç”¨ä¼ºæœå™¨é è¨­è¬›ç¾©ï¼‰",-1)),(0,s.Lk)("input",{type:"file",class:"form-control",accept:".zip",onChange:X},null,32),f.value?((0,s.uX)(),(0,s.CE)("small",Oa,"å·²é¸æ“‡: "+(0,g.v_)(f.value.name),1)):((0,s.uX)(),(0,s.CE)("small",qa,"æœªé¸æ“‡æª”æ¡ˆï¼Œå°‡ä½¿ç”¨ä¼ºæœå™¨é è¨­çš„ rag_db.zip"))]),(0,s.Lk)("div",Ya,[(0,s.Lk)("div",Za,[a[5]||(a[5]=(0,s.Lk)("label",{class:"form-label my-title-xs-gray"},"é¡Œå‹ (Qtype)",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>b.value=e),class:"form-select"},[...a[4]||(a[4]=[(0,s.Lk)("option",{value:"å¯¦ä½œé¡Œ"},"å¯¦ä½œé¡Œ (R Code)",-1),(0,s.Lk)("option",{value:"è§€å¿µç°¡ç­”é¡Œ"},"è§€å¿µç°¡ç­”é¡Œ",-1)])],512),[[l.u1,b.value]])]),(0,s.Lk)("div",et,[a[7]||(a[7]=(0,s.Lk)("label",{class:"form-label my-title-xs-gray"},"é›£åº¦ (Level)",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":a[1]||(a[1]=e=>k.value=e),class:"form-select"},[...a[6]||(a[6]=[(0,s.Lk)("option",{value:"å…¥é–€"},"å…¥é–€",-1),(0,s.Lk)("option",{value:"é€²éš"},"é€²éš",-1)])],512),[[l.u1,k.value]])])]),(0,s.Lk)("button",{class:"btn btn-primary w-100",onClick:M,disabled:L.value},[L.value?((0,s.uX)(),(0,s.CE)("span",tt)):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,g.v_)(L.value?"ğŸ§  AI æ­£åœ¨è®€å– Zip ä¸¦å‡ºé¡Œä¸­... (ç´„éœ€ 10-20 ç§’)":"ğŸš€ ç”Ÿæˆé¡Œç›®"),1)],8,at)]),w.value?((0,s.uX)(),(0,s.CE)("div",lt,[a[14]||(a[14]=(0,s.Lk)("h6",{class:"my-title-sm-black mb-3"},"2. é¡Œç›®èˆ‡ä½œç­”",-1)),(0,s.Lk)("div",nt,[a[11]||(a[11]=(0,s.Lk)("h6",{class:"my-title-xs-black mb-2"},"ğŸ“ é¡Œç›®ï¼š",-1)),(0,s.Lk)("div",st,(0,g.v_)(C.value),1),a[12]||(a[12]=(0,s.Lk)("hr",null,null,-1)),(0,s.Lk)("p",it,[a[9]||(a[9]=(0,s.Lk)("strong",null,"ğŸ’¡ æç¤ºï¼š",-1)),(0,s.Lk)("span",null,(0,g.v_)(D.value),1)]),(0,s.Lk)("p",rt,[a[10]||(a[10]=(0,s.Lk)("strong",null,"ğŸ“‚ å»ºè­°ä½¿ç”¨æª”æ¡ˆï¼š",-1)),(0,s.Lk)("code",null,(0,g.v_)(E.value),1)])]),(0,s.Lk)("div",ot,[a[13]||(a[13]=(0,s.Lk)("label",{class:"form-label my-title-xs-gray"},"è«‹åœ¨æ­¤è¼¸å…¥æ‚¨çš„å›ç­” (ç¨‹å¼ç¢¼æˆ–æ–‡å­—)ï¼š",-1)),(0,s.bo)((0,s.Lk)("textarea",{"onUpdate:modelValue":a[2]||(a[2]=e=>_.value=e),class:"form-control",rows:"8",placeholder:"ä¾‹å¦‚ï¼šlibrary(sf); st_read(...)"},null,512),[[l.Jo,_.value]])]),(0,s.Lk)("button",{class:"btn btn-success w-100",onClick:F,disabled:!_.value.trim()||R.value},[R.value?((0,s.uX)(),(0,s.CE)("span",ct)):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,g.v_)(R.value?"ğŸ‘€ AI æ­£åœ¨å°ç…§è¬›ç¾©é€²è¡Œè©•åˆ†...":"ğŸ“ é€å‡ºä¸¦è©•åˆ†"),1)],8,ut)])):(0,s.Q3)("",!0),I.value?((0,s.uX)(),(0,s.CE)("div",dt,[a[22]||(a[22]=(0,s.Lk)("h6",{class:"my-title-sm-black mb-3"},"3. è©•åˆ†å ±å‘Š",-1)),(0,s.Lk)("div",vt,[(0,s.Lk)("div",pt,[(0,s.Lk)("div",null,[a[15]||(a[15]=(0,s.eW)(" åˆ†æ•¸ï¼š",-1)),(0,s.Lk)("span",gt,(0,g.v_)(I.value.score),1),a[16]||(a[16]=(0,s.eW)(" / 10 ",-1))]),(0,s.Lk)("div",yt,"ç­‰ç´šï¼š"+(0,g.v_)(I.value.level),1)]),a[21]||(a[21]=(0,s.Lk)("hr",null,null,-1)),I.value.strengths&&I.value.strengths.length>0?((0,s.uX)(),(0,s.CE)("div",mt,[a[17]||(a[17]=(0,s.Lk)("h6",{class:"my-title-xs-black mb-2"},"ğŸ‘ å„ªé»ï¼š",-1)),(0,s.Lk)("ul",ht,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.value.strengths,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a,class:"text-success"},(0,g.v_)(e),1))),128))])])):(0,s.Q3)("",!0),I.value.weaknesses&&I.value.weaknesses.length>0?((0,s.uX)(),(0,s.CE)("div",ft,[a[18]||(a[18]=(0,s.Lk)("h6",{class:"my-title-xs-black mb-2"},"âš ï¸ å¾…æ”¹é€²ï¼š",-1)),(0,s.Lk)("ul",bt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.value.weaknesses,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a,class:"text-warning"},(0,g.v_)(e),1))),128))])])):(0,s.Q3)("",!0),I.value.action_items&&I.value.action_items.length>0?((0,s.uX)(),(0,s.CE)("div",kt,[a[19]||(a[19]=(0,s.Lk)("h6",{class:"my-title-xs-black mb-2"},"ğŸ“‹ å»ºè­°äº‹é …ï¼š",-1)),(0,s.Lk)("ul",Lt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.value.action_items,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a},(0,g.v_)(e),1))),128))])])):(0,s.Q3)("",!0),I.value.rubric&&I.value.rubric.length>0?((0,s.uX)(),(0,s.CE)("div",wt,[a[20]||(a[20]=(0,s.Lk)("h6",{class:"my-title-xs-black mb-2"},"ğŸ“Š è©•åˆ†æ¨™æº–ï¼š",-1)),(0,s.Lk)("ul",xt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(I.value.rubric,(e,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a},(0,g.v_)(e),1))),128))])])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])):((0,s.uX)(),(0,s.CE)("div",Tt,[(0,s.Lk)("div",Ct,[(0,s.Lk)("h5",Dt,(0,g.v_)(d.value),1)]),c.value&&y.value.length>0?((0,s.uX)(),(0,s.CE)("div",Et,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(y.value,([e,a])=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"mb-3"},[(0,s.Lk)("div",_t,(0,g.v_)(e),1),(0,s.Lk)("div",Rt,(0,g.v_)(p(a)),1)]))),128))])):c.value?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",It,[...a[24]||(a[24]=[(0,s.Lk)("div",{class:"my-title-md-gray"},"æ­¤åœ–å±¤æ²’æœ‰å¯ç”¨çš„å·¥ä½œè³‡æ–™",-1)])]))]))])):((0,s.uX)(),(0,s.CE)("div",Xt,[...a[25]||(a[25]=[(0,s.Lk)("div",{class:"text-center"},[(0,s.Lk)("div",{class:"my-title-md-gray p-3"},"æ²’æœ‰é–‹å•Ÿçš„åœ–å±¤")],-1)])]))]))}};const Ft=(0,c.A)(Mt,[["__scopeId","data-v-60a5d313"]]);var Kt=Ft,Wt={name:"UpperView",components:{DashboardTab:Na,WorkTab:Kt},props:{activeUpperTab:{type:String,default:"dashboard"},mainPanelWidth:{type:Number,default:60},contentHeight:{type:Number,default:500},selectedFilter:{type:String,default:""},zoomLevel:{type:Number,default:11},isPanelDragging:{type:Boolean,default:!1},activeMarkers:{type:Number,default:0}},emits:["update:activeUpperTab","update:zoomLevel","update:currentCoords","update:activeMarkers","feature-selected"],setup(e,{emit:a}){const t=T(),l=(0,x.KR)(null),n=(0,x.KR)(null),i=(0,x.KR)(null),r=(0,x.KR)(null),o=(0,x.KR)(null),u=["dashboard","work"],c=(0,s.EW)(()=>{const e={},a=o.value?t.findLayerById(o.value):null,l=Array.isArray(a?.upperViewTabs)?a.upperViewTabs:[];return u.forEach(a=>{e[a]=l.includes(a)}),e}),d=e=>{o.value=e},v=(0,s.EW)(()=>t.getAllLayers().filter(e=>e.visible)),p=(0,s.EW)(()=>v.value.length>0),g=(0,x.KR)([]);let y=!1;(0,s.wB)(()=>v.value.map(e=>e.layerId),l=>{if(y)return;if(!Array.isArray(l)||0===l.length)return o.value=null,void(g.value=[]);const n=g.value||[],i=l.filter(e=>!n.includes(e));if(i.length>0){const l=i[i.length-1];o.value=l;const n=t.findLayerById(l),r=Array.isArray(n?.upperViewTabs)?n.upperViewTabs:[],u=r[0]||null;u&&u!==e.activeUpperTab&&(y=!0,a("update:activeUpperTab",u),(0,s.dY)(()=>{y=!1}))}else o.value&&l.includes(o.value)||(o.value=l[0]);g.value=[...l]},{immediate:!0}),(0,s.wB)(()=>o.value,l=>{if(!l||y)return;const n=t.findLayerById(l),i=Array.isArray(n?.upperViewTabs)?n.upperViewTabs:[],r=e.activeUpperTab;if(r&&i.length>0&&!i.includes(r)){const e=i[0]||null;e&&e!==r&&(y=!0,a("update:activeUpperTab",e),(0,s.dY)(()=>{y=!1}))}},{immediate:!0}),(0,s.wB)([()=>e.isPanelDragging,()=>e.activeUpperTab],([e,a])=>{(0,s.dY)(()=>{n.value&&(n.value.style.pointerEvents=e&&"dashboard"===a?"none":"auto"),r.value&&(r.value.style.pointerEvents=e&&"work"===a?"none":"auto")})},{immediate:!0}),(0,s.wB)([()=>e.mainPanelWidth,()=>e.contentHeight],()=>{});const m=()=>{setTimeout(()=>{const e=new Event("resize");window.dispatchEvent(e)},50)};return{DashboardTab:l,WorkTab:i,dashboardContainerRef:n,workContainerRef:r,invalidateMapSize:m,getIcon:ye,isTabEnabled:c,handleActiveLayerChange:d,activeUpperLayerId:o,hasVisibleLayers:p}}};const jt=(0,c.A)(Wt,[["render",wa]]);var zt=jt;const St={ref:"bottomTabContentRef",class:"flex-grow-1 h-100 overflow-auto"},Nt={class:"h-100"};function At(e,a,t,l,n,i){const r=(0,s.g2)("DataTableTab");return(0,s.uX)(),(0,s.CE)("div",{class:"d-flex flex-column",style:(0,g.Tr)({height:t.bottomViewHeight+"px"})},[(0,s.Lk)("div",St,[(0,s.Lk)("div",Nt,[(0,s.bF)(r,{onHighlightOnMap:a[0]||(a[0]=a=>e.$emit("highlight-on-map",a)),onFeatureSelected:a[1]||(a[1]=a=>e.$emit("feature-selected",a))})])],512)],4)}t(7588);const Gt={class:"d-flex flex-column my-bgcolor-gray-200 h-100"},$t={key:0,class:""},Pt={class:"nav nav-tabs nav-fill"},Vt=["onClick"],Jt={class:"my-title-sm-black"},Ht={key:0,class:"my-title-xs-gray"},Bt={key:1,class:"my-content-xs-gray ms-2"},Ut={key:1,class:"flex-grow-1 overflow-hidden"},Qt={class:"h-100 d-flex flex-column"},Ot={class:"flex-grow-1 overflow-auto"},qt={class:"table w-100 mb-0"},Yt={class:"sticky-top my-table-thead"},Zt={class:"text-center text-nowrap"},el=["onClick"],al={class:"my-title-xs-gray text-nowrap"},tl={class:"my-title-xs-gray text-nowrap ms-2"},ll=["onClick"],nl={key:0,class:"border-0 text-nowrap text-truncate p-0",style:{"max-width":"80px"}},sl={key:0,class:"d-flex align-items-center justify-content-center px-3 py-2"},il=["title"],rl={class:"my-content-xs-black"},ol={key:1,class:"my-content-xs-black px-3 py-2"},ul={key:2,class:"my-content-xs-black px-3 py-2"},cl={class:"d-flex flex-column"},dl={key:3,class:"my-content-xs-black px-3 py-2"},vl={class:"d-flex flex-column"},pl={key:4,class:"my-content-xs-black px-3 py-2"},gl={class:"d-flex flex-column"},yl={key:5,class:"my-content-xs-black px-3 py-2"},ml={key:6,class:"d-flex align-items-center justify-content-center px-3 py-2"},hl=["title"],fl={class:"my-content-xs-black"},bl={key:7,class:"d-flex p-0"},kl={class:"my-content-xs-black w-100 px-3 py-2"},Ll={key:8,class:"d-flex align-items-center justify-content-center px-3 py-2"},wl=["title"],xl={class:"my-content-xs-black"},Tl={key:9,class:"d-flex align-items-center justify-content-center px-3 py-2"},Cl=["title"],Dl={class:"my-content-xs-black"},El={key:10,class:"d-flex align-items-center justify-content-center px-3 py-2"},_l=["title"],Rl={class:"my-content-xs-black"},Il={key:11,class:"d-flex align-items-center justify-content-center px-3 py-2"},Xl=["title"],Ml={class:"my-content-xs-black"},Fl={key:12,class:"my-content-xs-black px-3 py-2"},Kl={key:2,class:"flex-grow-1 d-flex align-items-center justify-content-center"};var Wl={__name:"DataTableTab",emits:["highlight-on-map","feature-selected"],setup(e,{emit:a}){const t=a,n=T(),i=(0,x.KR)(null),r=(0,x.KR)({}),o=(0,s.EW)(()=>{const e=n.getAllLayers();return e.filter(e=>e.visible)}),u=e=>{i.value=e},c=e=>{if(!e)return{groupName:null,layerName:"æœªçŸ¥åœ–å±¤"};const a=n.findGroupNameByLayerId(e.layerId);return{groupName:a,layerName:e.layerName}},d=e=>{const a=e.dataTableData;if(!a||0===a.length)return[];const t=new Set;a.forEach(e=>{Object.keys(e).forEach(a=>{const l=e[a];"color"===a||"name"===a||"nodes"===a?t.add(a):"object"===typeof l&&null!==l||t.add(a)})});const l=Array.from(t),n=["id","segment_index","start_idx","end_idx","weight_index"],s=l.filter(e=>!n.includes(e));return s},v=e=>{const a=e.dataTableData?.length||0;return a},p=e=>{if(!e.dataTableData)return[];const a=r.value[e.layerId];return a&&a.key?[...e.dataTableData].sort((e,t)=>{const l=e[a.key],n=t[a.key],s=["count","spatial_lag","#","P_CNT","æ„ŸæŸ“ç‡(%)"];if(s.includes(a.key)){const e=parseFloat(l)||0,t=parseFloat(n)||0;return"asc"===a.order?e-t:t-e}return"string"===typeof l&&"string"===typeof n?"asc"===a.order?l.localeCompare(n):n.localeCompare(l):"asc"===a.order?l-n:n-l}):e.dataTableData},y=(e,a)=>{r.value[e]||(r.value[e]={key:null,order:"asc"});const t=r.value[e];t.key===a?t.order="asc"===t.order?"desc":"asc":(t.key=a,t.order="asc")},m=(e,a)=>{const t=r.value[e];return t&&t.key===a?"asc"===t.order?ye("sort_up").icon:ye("sort_down").icon:ye("sort").icon},h=(e,a)=>{const l={properties:{id:e["#"]||e.id||"unknown",layerId:a.layerId,propertyData:{...e},itemColor:e.color||"#6c757d"}};n.setSelectedFeature(l),t("feature-selected",l)},f=(0,x.KR)([]);return(0,s.wB)(()=>o.value,e=>{if(0===e.length)return i.value=null,void(f.value=[]);const a=f.value.map(e=>e.layerId),t=e.map(e=>e.layerId),l=t.filter(e=>!a.includes(e));if(l.length>0){const e=l[l.length-1];i.value=e}else i.value&&e.find(e=>e.layerId===i.value)||(i.value=e[0].layerId);f.value=[...e]},{deep:!0,immediate:!0}),(0,s.sV)(()=>{o.value.length>0&&!i.value&&(i.value=o.value[0].layerId)}),(e,a)=>((0,s.uX)(),(0,s.CE)("div",Gt,[o.value.length>0?((0,s.uX)(),(0,s.CE)("div",$t,[(0,s.Lk)("ul",Pt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.value,e=>((0,s.uX)(),(0,s.CE)("li",{key:e.layerId,class:"nav-item d-flex flex-column align-items-center"},[(0,s.Lk)("div",{class:(0,g.C4)(["btn nav-link rounded-0 border-0 position-relative d-flex align-items-center justify-content-center my-bgcolor-gray-200",{active:i.value===e.layerId}]),onClick:a=>u(e.layerId)},[(0,s.Lk)("span",Jt,[c(e).groupName?((0,s.uX)(),(0,s.CE)("span",Ht,(0,g.v_)(c(e).groupName)+" - ",1)):(0,s.Q3)("",!0),(0,s.Lk)("span",null,(0,g.v_)(c(e).layerName),1),v(e)?((0,s.uX)(),(0,s.CE)("span",Bt,(0,g.v_)(v(e)),1)):(0,s.Q3)("",!0)])],10,Vt),(0,s.Lk)("div",{class:(0,g.C4)(["w-100",`my-bgcolor-${e.colorName}`]),style:{"min-height":"4px"}},null,2)]))),128))])])):(0,s.Q3)("",!0),o.value.length>0?((0,s.uX)(),(0,s.CE)("div",Ut,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.value,e=>(0,s.bo)(((0,s.uX)(),(0,s.CE)("div",{key:e.layerId,class:"h-100"},[(0,s.Lk)("div",Qt,[(0,s.Lk)("div",Ot,[(0,s.Lk)("table",qt,[(0,s.Lk)("thead",Yt,[(0,s.Lk)("tr",Zt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(d(e),a=>((0,s.uX)(),(0,s.CE)(s.FK,{key:a},[a.endsWith("_color")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("th",{key:0,onClick:t=>y(e.layerId,a),class:"my-bgcolor-white-hover p-1 my-cursor-pointer"},[(0,s.Lk)("span",al,(0,g.v_)("nodes"===a?"ç¯€é»æ•¸":a),1),(0,s.Lk)("span",tl,[(0,s.Lk)("i",{class:(0,g.C4)(m(e.layerId,a))},null,2)])],8,el))],64))),128))])]),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(p(e),a=>((0,s.uX)(),(0,s.CE)("tr",{key:a.id,class:"my-table-tr-hover text-center text-nowrap border-bottom my-cursor-pointer",onClick:t=>h(a,e)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(d(e),e=>((0,s.uX)(),(0,s.CE)(s.FK,{key:e},[e.endsWith("_color")?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("td",nl,["color"===e?((0,s.uX)(),(0,s.CE)("div",sl,[(0,s.Lk)("div",{class:"rounded-circle me-2",style:(0,g.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:a[e]}]),title:a[e]},null,12,il),(0,s.Lk)("div",rl,(0,g.v_)(a[e]||"-"),1)])):"nodes"===e?((0,s.uX)(),(0,s.CE)("div",ol,(0,g.v_)(Array.isArray(a[e])?a[e].length:"-"),1)):"xRowMinMax"===e?((0,s.uX)(),(0,s.CE)("div",ul,[(0,s.Lk)("div",cl,[(0,s.Lk)("div",null,"æœ€å°å€¼: "+(0,g.v_)(a[e]?.min||"-"),1),(0,s.Lk)("div",null,"æœ€å¤§å€¼: "+(0,g.v_)(a[e]?.max||"-"),1)])])):"yRowMinMax"===e?((0,s.uX)(),(0,s.CE)("div",dl,[(0,s.Lk)("div",vl,[(0,s.Lk)("div",null,"æœ€å°å€¼: "+(0,g.v_)(a[e]?.min||"-"),1),(0,s.Lk)("div",null,"æœ€å¤§å€¼: "+(0,g.v_)(a[e]?.max||"-"),1)])])):"overallStats"===e?((0,s.uX)(),(0,s.CE)("div",pl,[(0,s.Lk)("div",gl,[(0,s.Lk)("div",null,"æœ€å°å€¼: "+(0,g.v_)(a[e]?.min||"-"),1),(0,s.Lk)("div",null,"æœ€å¤§å€¼: "+(0,g.v_)(a[e]?.max||"-"),1),(0,s.Lk)("div",null,"å¹³å‡: "+(0,g.v_)(a[e]?.avg||"-"),1)])])):"name"===e?((0,s.uX)(),(0,s.CE)("div",yl,(0,g.v_)(a[e]||"-"),1)):"route_name"===e?((0,s.uX)(),(0,s.CE)("div",ml,[a["route_color"]?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,g.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:a["route_color"]}]),title:a["route_color"]},null,12,hl)):(0,s.Q3)("",!0),(0,s.Lk)("div",fl,(0,g.v_)(a[e]||"-"),1)])):"#"===e?((0,s.uX)(),(0,s.CE)("div",bl,[(0,s.Lk)("div",{style:(0,g.Tr)([{"min-width":"6px"},{backgroundColor:a["color"]}])},null,4),(0,s.Lk)("div",kl,(0,g.v_)(a[e]??"-"),1)])):"spatial_lag"===e?((0,s.uX)(),(0,s.CE)("div",Ll,[a["spatial_lag_color"]?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,g.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:a["spatial_lag_color"]}]),title:a["spatial_lag_color"]},null,12,wl)):(0,s.Q3)("",!0),(0,s.Lk)("div",xl,(0,g.v_)("number"===typeof a[e]?a[e].toFixed(2):a[e]||"-"),1)])):"binaryValue"===e?((0,s.uX)(),(0,s.CE)("div",Tl,[a["joinCounts_color"]?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,g.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:a["joinCounts_color"]}]),title:a["joinCounts_color"]},null,12,Cl)):(0,s.Q3)("",!0),(0,s.Lk)("div",Dl,(0,g.v_)(a[e]),1)])):"count"===e?((0,s.uX)(),(0,s.CE)("div",El,[a["color"]?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,g.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:a["color"]}]),title:a["color"]},null,12,_l)):(0,s.Q3)("",!0),(0,s.Lk)("div",Rl,(0,g.v_)(a[e]),1)])):"æ„ŸæŸ“ç‡(%)"===e?((0,s.uX)(),(0,s.CE)("div",Il,[a["infection_rate_color"]?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"rounded-circle me-2",style:(0,g.Tr)([{width:"12px",height:"12px","flex-shrink":"0"},{backgroundColor:a["infection_rate_color"]}]),title:a["infection_rate_color"]},null,12,Xl)):(0,s.Q3)("",!0),(0,s.Lk)("div",Ml,(0,g.v_)(a[e]||"-"),1)])):((0,s.uX)(),(0,s.CE)("div",Fl,(0,g.v_)(a[e]??"-"),1))]))],64))),128))],8,ll))),128))])])])])])),[[l.aG,i.value===e.layerId]])),128))])):((0,s.uX)(),(0,s.CE)("div",Kl,[...a[0]||(a[0]=[(0,s.Lk)("div",{class:"text-center"},[(0,s.Lk)("div",{class:"my-title-md-gray p-3"},"æ²’æœ‰é–‹å•Ÿçš„åœ–å±¤")],-1)])]))]))}};const jl=(0,c.A)(Wl,[["__scopeId","data-v-44bcb2a2"]]);var zl=jl,Sl={name:"BottomView",components:{DataTableTab:zl},props:{activeBottomTab:{type:String,default:"table"},bottomViewHeight:{type:Number,default:300},isPanelDragging:{type:Boolean,default:!1}},emits:["update:activeBottomTab","highlight-on-map","feature-selected","reset-view"],setup(e){const a=(0,x.KR)(null);return(0,s.wB)(()=>e.activeBottomTab,()=>{(0,s.dY)(()=>{})}),{bottomTabContentRef:a}}};const Nl=(0,c.A)(Sl,[["render",At]]);var Al=Nl;const Gl={class:"d-flex flex-column overflow-hidden h-100"};var $l={__name:"MiddleView",props:{activeUpperTab:{type:String,default:"d3js"},activeBottomTab:{type:String,default:"table"},mainPanelWidth:{type:Number,default:60},dynamicMainAreaHeight:{type:Number,default:500},selectedFilter:{type:String,default:""},zoomLevel:{type:Number,default:11},currentCoords:{type:Object,default:()=>({lat:25.033,lng:121.5654})},activeMarkers:{type:Number,default:0},isSidePanelDragging:{type:Boolean,default:!1}},emits:["update:activeUpperTab","update:activeBottomTab","update:zoomLevel","update:currentCoords","update:activeMarkers","update:tableSearchQuery","sort-table","highlight-on-map","feature-selected","reset-view"],setup(e,{expose:a}){const t=e,l=(0,x.KR)(null),n=(0,x.KR)(30),i=(0,x.KR)(!1),r=(0,s.EW)(()=>t.isSidePanelDragging||i.value),o=(0,s.EW)(()=>{const e=t.dynamicMainAreaHeight;return Math.max(e,0)}),u=(0,s.EW)(()=>{const e=n.value/100*o.value;return e}),c=(0,s.EW)(()=>{const e=o.value-u.value;return e}),d=e=>{e.preventDefault(),e.stopPropagation(),i.value=!0,document.body.classList.add("my-no-select");const a=e.clientY,t=n.value,l=o.value,s=e=>{e.preventDefault();const s=e.clientY-a;if(0===l)return;const i=s/l*100;let r=t-i;r=Math.max(0,Math.min(100,r)),n.value=Math.round(10*r)/10},r=()=>{i.value=!1,document.body.classList.remove("my-no-select"),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",r)};(0,s.wB)(()=>t.activeUpperTab,()=>{}),(0,s.sV)(()=>{}),(0,s.hi)(()=>{});const v=e=>{l.value?l.value.highlightFeature(e):console.warn("âš ï¸ ç„¡æ³•é«˜äº®é¡¯ç¤ºï¼šmainContentRef æœªå®šç¾©")},p=()=>{l.value&&l.value.fitToTainanBounds()},y=()=>{},m=()=>{l.value&&l.value.invalidateMapSize()},h=()=>{l.value&&l.value.stopMapClickMode()};return a({highlightFeature:v,fitToTainanBounds:p,resetMapTab:y,invalidateMapSize:m,stopMapClickMode:h}),(a,t)=>((0,s.uX)(),(0,s.CE)("div",Gl,[(0,s.Lk)("div",{style:(0,g.Tr)({pointerEvents:r.value?"none":"auto",height:c.value+"px",overflow:"hidden",minHeight:"0"})},[(0,s.bF)(zt,{ref_key:"mainContentRef",ref:l,activeUpperTab:e.activeUpperTab,mainPanelWidth:e.mainPanelWidth,contentHeight:c.value,selectedFilter:e.selectedFilter,zoomLevel:e.zoomLevel,isPanelDragging:r.value,activeMarkers:e.activeMarkers,"onUpdate:activeUpperTab":t[0]||(t[0]=e=>a.$emit("update:activeUpperTab",e)),"onUpdate:zoomLevel":t[1]||(t[1]=e=>a.$emit("update:zoomLevel",e)),"onUpdate:currentCoords":t[2]||(t[2]=e=>a.$emit("update:currentCoords",e)),"onUpdate:activeMarkers":t[3]||(t[3]=e=>a.$emit("update:activeMarkers",e)),onFeatureSelected:t[4]||(t[4]=e=>a.$emit("feature-selected",e))},null,8,["activeUpperTab","mainPanelWidth","contentHeight","selectedFilter","zoomLevel","isPanelDragging","activeMarkers"])],4),(0,s.Lk)("div",{class:(0,g.C4)(["my-resizer my-resizer-horizontal my-resizer-middle",{"my-dragging":i.value}]),onMousedown:d,title:"æ‹–æ›³èª¿æ•´åº•éƒ¨é¢æ¿é«˜åº¦"},null,34),(0,s.Lk)("div",{class:"overflow-hidden",style:(0,g.Tr)({pointerEvents:r.value?"none":"auto",height:u.value+"px"})},[(0,s.bF)(Al,{activeBottomTab:e.activeBottomTab,bottomViewHeight:u.value,isPanelDragging:r.value,"onUpdate:activeBottomTab":t[5]||(t[5]=e=>a.$emit("update:activeBottomTab",e)),onHighlightOnMap:t[6]||(t[6]=e=>a.$emit("highlight-on-map",e)),onFeatureSelected:t[7]||(t[7]=e=>a.$emit("feature-selected",e)),onResetView:t[8]||(t[8]=e=>a.$emit("reset-view"))},null,8,["activeBottomTab","bottomViewHeight","isPanelDragging"])],4)]))}};const Pl=$l;var Vl=Pl;const Jl={class:"d-flex flex-column h-100 my-bgcolor-gray-200"},Hl={class:"flex-grow-1 overflow-hidden",style:{"padding-bottom":"70px"}},Bl={class:"h-100"},Ul={class:"h-100"},Ql={class:"h-100"},Ol=["onClick"],ql={class:"d-flex flex-column align-items-center justify-content-center w-100"},Yl={class:"my-font-size-sm"},Zl={class:"my-font-size-xs"};function en(e,a,t,n,i,r){const o=(0,s.g2)("LayersTab"),u=(0,s.g2)("DataTableTab"),c=(0,s.g2)("LayerInfo");return(0,s.uX)(),(0,s.CE)("div",Jl,[(0,s.Lk)("div",Hl,[(0,s.bo)((0,s.Lk)("div",Bl,[(0,s.bF)(o)],512),[[l.aG,"layers"===t.activeTab]]),(0,s.bo)((0,s.Lk)("div",Ul,[(0,s.bF)(u,{onHighlightOnMap:a[0]||(a[0]=a=>e.$emit("highlight-on-map",a)),onFeatureSelected:a[1]||(a[1]=a=>e.$emit("feature-selected",a))})],512),[[l.aG,"table"===t.activeTab]]),(0,s.bo)((0,s.Lk)("div",Ql,[(0,s.bF)(c)],512),[[l.aG,"layer-info"===t.activeTab]])]),(0,s.Lk)("div",{class:"position-fixed bottom-0 start-0 end-0 d-flex align-items-center justify-content-between my-bgcolor-gray-200 border-top z-100 w-100",style:(0,g.Tr)(n.getBottomNavStyle)},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.availableTabs,e=>((0,s.uX)(),(0,s.CE)("button",{key:e.id,class:(0,g.C4)(["d-flex rounded-3 border-0 flex-grow-1 py-2 mx-1",{"my-btn-transparent":t.activeTab!==e.id,"my-btn-active":t.activeTab===e.id}]),style:{"min-height":"44px","touch-action":"manipulation","-webkit-appearance":"none !important"},onClick:a=>n.switchTab(e.id)},[(0,s.Lk)("div",ql,[(0,s.Lk)("span",Yl,[(0,s.Lk)("i",{class:(0,g.C4)([e.icon,"mb-1"])},null,2)]),(0,s.Lk)("span",Zl,(0,g.v_)(e.name),1)])],10,Ol))),128))],4)])}var an={name:"ResponsiveLowerView",components:{LayersTab:te,DataTableTab:zl,LayerInfo:Se},props:{activeTab:{type:String,default:"layers"},activeRightTab:{type:String,default:"layer-info"},activeBottomTab:{type:String,default:"table"}},emits:["update:activeTab","update:activeRightTab","update:activeBottomTab","highlight-on-map","highlight-feature","feature-selected"],setup(e,{emit:a}){const t=(0,x.KR)(0),l=(0,s.EW)(()=>[{id:"layers",name:"åœ–å±¤",icon:ye("layer_group").icon},{id:"table",name:"è³‡æ–™è¡¨",icon:ye("table").icon},{id:"layer-info",name:"åœ–å±¤è³‡è¨Š",icon:ye("info_circle").icon}]),n=()=>{const e=window.innerHeight,a=window.visualViewport?.height||e,l=e-a;t.value=l>0?l:0},i=(0,s.EW)(()=>{const e=60,a=t.value>0?t.value+10:10;return{"min-height":`${e}px`,height:`${e+a}px`,padding:`8px 4px ${a}px 4px`}}),r=e=>{a("update:activeTab",e)};return(0,s.sV)(()=>{n(),window.addEventListener("resize",n),window.visualViewport&&(window.visualViewport.addEventListener("resize",n),window.visualViewport.addEventListener("scroll",n)),window.addEventListener("orientationchange",()=>{setTimeout(n,300)})}),(0,s.hi)(()=>{window.removeEventListener("resize",n),window.visualViewport&&(window.visualViewport.removeEventListener("resize",n),window.visualViewport.removeEventListener("scroll",n)),window.removeEventListener("orientationchange",n)}),{availableTabs:l,switchTab:r,getBottomNavStyle:i,bottomSafeArea:t}}};const tn=(0,c.A)(an,[["render",en],["__scopeId","data-v-0cbb10b2"]]);var ln=tn,nn={name:"HomeView",components:{LoadingOverlay:j,LeftView:se,RightView:va,MiddleView:Vl,UpperView:zt,ResponsiveLowerView:ln},setup(){const e=T(),a=(0,x.KR)(null),t=(0,x.KR)(null),l=(0,x.KR)(null),n=(0,x.KR)("d3js"),i=(0,x.KR)("table"),r=(0,x.KR)("layer-info"),o=(0,x.KR)("layers"),u=5,c=(0,x.KR)(20),d=(0,x.KR)(20),v=(0,x.KR)(window.innerWidth),p=(0,x.KR)(window.innerHeight),g=(0,x.KR)(0),y=(0,s.EW)(()=>`${c.value}%`),m=(0,s.EW)(()=>`${d.value}%`),h=(0,s.EW)(()=>100-c.value-d.value),f=(0,s.EW)(()=>`${h.value}%`),b=(0,s.EW)(()=>p.value-g.value),k=(0,s.EW)(()=>Math.max(400,(100-G.value)*p.value*.01)),L=(0,x.KR)("è¼‰å…¥ä¸­..."),w=(0,x.KR)(0),C=(0,x.KR)(!1),D=(0,x.KR)(""),E=(0,s.EW)(()=>e.getAllLayers().some(e=>e.isLoading));(0,s.wB)(E,a=>{if(a){const a=e.getAllLayers().find(e=>e.isLoading);a&&(L.value=`è¼‰å…¥ ${a.layerName} æ•¸æ“šä¸­...`,D.value="æ­£åœ¨è™•ç†åœ°ç†è³‡è¨Š...")}else L.value="è¼‰å…¥å®Œæˆ",D.value="æ•¸æ“šå·²æ›´æ–°"});const _=(0,x.KR)(11),R=(0,x.KR)({lat:25.033,lng:121.5654}),I=(0,x.KR)(0),X=(0,x.KR)(!1),M=()=>{},F=(e,a)=>{a.preventDefault(),a.stopPropagation(),X.value=!0,document.body.classList.add("my-no-select");const t=a.clientX,l=c.value,n=d.value,s=v.value,i=a=>{a.preventDefault();const i=a.clientX-t,r=i/s*100;if("left"===e){let e=l+r;e=Math.max(u,Math.min(100-d.value,e)),c.value=e}else if("right"===e){let e=n-r;e=Math.max(0,Math.min(100-c.value,e)),d.value=e}},r=()=>{X.value=!1,document.body.classList.remove("my-no-select"),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),K()};document.addEventListener("mousemove",i),document.addEventListener("mouseup",r)},K=()=>{c.value=Math.max(u,Math.min(100,c.value)),d.value=Math.max(0,Math.min(100,d.value)),c.value=Math.round(10*c.value)/10,d.value=Math.round(10*d.value)/10};let W=null;const j=()=>{W&&clearTimeout(W),W=setTimeout(()=>{const e=v.value,n=e>=1200,i=window.innerWidth,r=window.innerHeight;if(Math.abs(v.value-i)<1&&Math.abs(p.value-r)<1)return;v.value=i,p.value=r;const o=i>=1200;n!==o?U():(0,s.dY)(()=>{setTimeout(()=>{o&&a.value?a.value.invalidateMapSize&&a.value.invalidateMapSize():!o&&t.value&&t.value.invalidateMapSize&&t.value.invalidateMapSize()},100)}),(0,s.dY)(()=>{if(l.value&&i>=1200?g.value=l.value.offsetHeight:g.value=0,!o){const e=A();G.value<e&&(G.value=Math.round(e))}})},150)};(0,s.sV)(()=>{window.addEventListener("resize",j),(0,s.dY)(()=>{l.value&&window.innerWidth>=1200?g.value=l.value.offsetHeight:g.value=0}),window.ResizeObserver&&(Q=new ResizeObserver(e=>{for(let a of e){const{width:e}=a.contentRect,t=e>=1200,l=a.target.classList.contains("xl-and-above");t!==l&&(a.target.classList.toggle("xl-and-above",t),U())}}),Q.observe(document.body))});const z=e=>{I.value=e},S=a=>{e.setSelectedFeature(a);const t=window.innerWidth>=1200;t?r.value="layer-info":(o.value="layer-info",G.value<30&&(G.value=40))},N=e=>{"map"!==n.value&&(n.value="map"),(0,s.dY)(()=>{const l=window.innerWidth>=1200;l?a.value?a.value.highlightFeature(e):console.error("âŒ ç„¡æ³•é«˜äº®é¡¯ç¤º: middlePanelRef ä¸å¯ç”¨"):t.value?t.value.highlightFeature(e):console.error("âŒ ç„¡æ³•é«˜äº®é¡¯ç¤º: mobileUpperViewRef ä¸å¯ç”¨")})},A=()=>{const e=100,a=window.innerHeight;return Math.max(10,e/a*100)},G=(0,x.KR)(Math.max(40,A())),$=(0,x.KR)(!1),P=(0,x.KR)(0),V=e=>{e.preventDefault(),e.stopPropagation(),$.value=!0,document.body.classList.add("my-no-select");const a=e.type.startsWith("touch"),t=a?e.touches[0].clientY:e.clientY,l=t,n=G.value,s=window.innerHeight,i=e=>{e.preventDefault();const a=e.type.startsWith("touch")?e.touches[0].clientY:e.clientY,t=a-l,i=t/s*100;let r=n-i;const o=A();r=Math.max(o,Math.min(100,r)),G.value=Math.round(r)},r=()=>{$.value=!1,document.body.classList.remove("my-no-select"),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",r),document.removeEventListener("touchmove",i),document.removeEventListener("touchend",r),document.removeEventListener("touchcancel",r)};a?(document.addEventListener("touchmove",i,{passive:!1}),document.addEventListener("touchend",r),document.addEventListener("touchcancel",r)):(document.addEventListener("mousemove",i),document.addEventListener("mouseup",r))};let J=null,H=window.innerHeight;(0,s.wB)(p,e=>{Math.abs(e-H)<1||(H=e,J&&clearTimeout(J),J=setTimeout(()=>{P.value+=1,J=null},200))},{flush:"post"});let B=!1;const U=()=>{B||(B=!0,P.value+=1,(0,s.dY)(()=>{setTimeout(()=>{const e=window.innerWidth>=1200;e?a.value&&a.value.invalidateMapSize&&a.value.invalidateMapSize():t.value&&t.value.invalidateMapSize&&t.value.invalidateMapSize(),B=!1},300)}))};let Q=null;return(0,s.hi)(()=>{window.removeEventListener("resize",j),Q&&Q.disconnect(),J&&(clearTimeout(J),J=null),W&&(clearTimeout(W),W=null)}),{middlePanelRef:a,activeUpperTab:n,activeBottomTab:i,activeRightTab:r,activeLowerTab:o,isAnyLayerLoading:E,loadingText:L,loadingProgress:w,showLoadingProgress:C,loadingSubText:D,zoomLevel:_,currentCoords:R,activeMarkers:I,leftViewWidth:c,rightViewWidth:d,leftViewWidthPx:y,rightViewWidthPx:m,mainPanelWidth:h,mainPanelWidthPx:f,resetView:M,startResize:F,startVerticalResize:V,isSidePanelDragging:X,isVerticalDragging:$,mobileBottomViewHeight:G,mobileMapKey:P,validatePanelSizes:K,appFooterRef:l,mobileUpperViewRef:t,calculatedMiddleViewHeight:b,mobileUpperContentHeight:k,handleHighlight:N,updateActiveMarkers:z,handleFeatureSelected:S}}};const sn=(0,c.A)(nn,[["render",w]]);var rn=sn;const on={class:"rag-container"},un={class:"rag-card"},cn={key:0,class:"file-info"},dn=["disabled"],vn={key:0,class:"loader"},pn={key:2,class:"download-link"},gn=["href","download"];function yn(e,a,t,n,i,r){return(0,s.uX)(),(0,s.CE)("div",on,[(0,s.Lk)("div",un,[a[7]||(a[7]=(0,s.Lk)("h1",{class:"title"},"ğŸ—‚ï¸ è£½ä½œ RAG è³‡æ–™åº«",-1)),a[8]||(a[8]=(0,s.Lk)("p",{class:"description"},[(0,s.eW)(" è«‹å°‡æ‚¨çš„åŸå§‹æ•™æ (PDF, DOCX ç­‰) å£“ç¸®æˆ "),(0,s.Lk)("strong",null,".zip"),(0,s.eW)(" æª”ä¸Šå‚³ï¼Œç³»çµ±æœƒå°‡æ–‡ä»¶è½‰æ›æˆå‘é‡è³‡æ–™åº«ä¾›ä¸‹è¼‰ã€‚ ")],-1)),a[9]||(a[9]=(0,s.Lk)("div",{class:"tip"},[(0,s.eW)(" ğŸ’¡ "),(0,s.Lk)("strong",null,"æç¤ºï¼š"),(0,s.eW)(" æ”¯æ´å·¢ç‹€è³‡æ–™å¤¾çµæ§‹ (Nested Folders)ã€‚ç³»çµ±æœƒè‡ªå‹•ä¿ç•™æª”æ¡ˆè·¯å¾‘è³‡è¨Šï¼Œæ–¹ä¾¿ RAG æº¯æºã€‚ ")],-1)),(0,s.Lk)("div",{class:(0,g.C4)(["upload-area",{"drag-over":n.isDragOver}]),onClick:a[1]||(a[1]=a=>e.$refs.fileInput.click()),onDragover:a[2]||(a[2]=(0,l.D$)((...e)=>n.handleDragOver&&n.handleDragOver(...e),["prevent"])),onDragleave:a[3]||(a[3]=(0,l.D$)((...e)=>n.handleDragLeave&&n.handleDragLeave(...e),["prevent"])),onDrop:a[4]||(a[4]=(0,l.D$)((...e)=>n.handleDrop&&n.handleDrop(...e),["prevent"]))},[(0,s.Lk)("input",{ref:"fileInput",type:"file",accept:".zip",onChange:a[0]||(a[0]=(...e)=>n.handleFileSelect&&n.handleFileSelect(...e)),style:{display:"none"}},null,544),(0,s.Lk)("span",null,(0,g.v_)(n.uploadText),1)],34),n.selectedFile?((0,s.uX)(),(0,s.CE)("div",cn," ğŸ“¦ å·²é¸æ“‡: "+(0,g.v_)(n.selectedFile.name),1)):(0,s.Q3)("",!0),(0,s.Lk)("button",{class:"submit-btn",onClick:a[5]||(a[5]=(...e)=>n.processFile&&n.processFile(...e)),disabled:!n.selectedFile||n.isProcessing},[n.isProcessing?((0,s.uX)(),(0,s.CE)("span",vn)):(0,s.Q3)("",!0),(0,s.Lk)("span",null,(0,g.v_)(n.buttonText),1)],8,dn),n.statusMessage?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,g.C4)(["status",n.statusClass])},(0,g.v_)(n.statusMessage),3)):(0,s.Q3)("",!0),n.downloadUrl?((0,s.uX)(),(0,s.CE)("div",pn,[(0,s.Lk)("a",{href:n.downloadUrl,download:n.downloadFileName,onClick:a[6]||(a[6]=(...e)=>n.handleDownload&&n.handleDownload(...e))}," ğŸ”— é»æ“Šä¸‹è¼‰ "+(0,g.v_)(n.downloadFileName),9,gn)])):(0,s.Q3)("",!0),a[10]||(a[10]=(0,s.Lk)("div",{class:"note"},[(0,s.eW)(" âš ï¸ "),(0,s.Lk)("strong",null,"æ³¨æ„ï¼š"),(0,s.Lk)("br"),(0,s.eW)(" 1. æª”æ¡ˆå¤§å°è«‹å‹¿éå¤§ï¼Œä»¥å…é€£ç·šé€¾æ™‚ã€‚"),(0,s.Lk)("br"),(0,s.eW)(" 2. è‹¥ Hugging Face ä¸»æ©Ÿä¼‘çœ ä¸­ï¼Œé¦–æ¬¡åŸ·è¡Œå¯èƒ½éœ€ç­‰å¾… 1-3 åˆ†é˜å–šé†’ã€‚ ")],-1))])])}t(4603),t(7566),t(8721);var mn={name:"RagView",setup(){const e="https://kevin7261-gisgym.hf.space/process_zip",a=(0,x.KR)(null),t=(0,x.KR)(!1),l=(0,x.KR)(""),n=(0,x.KR)(""),i=(0,x.KR)(""),r=(0,x.KR)(""),o=(0,x.KR)(!1),u=(0,s.EW)(()=>o.value?"æ”¾é–‹ä»¥ä¸Šå‚³æª”æ¡ˆ":"é»æ“Šæˆ–æ‹–æ›³ ZIP æª”æ¡ˆè‡³æ­¤"),c=(0,s.EW)(()=>t.value?"è™•ç†ä¸­...":"ä¸Šå‚³ä¸¦å»ºç«‹ RAG è³‡æ–™åº«"),d=(0,s.EW)(()=>`status-${n.value}`),v=e=>{const t=e.target.files;t&&t.length>0&&(a.value=t[0],l.value="",i.value="")},p=()=>{o.value=!0},g=()=>{o.value=!1},y=e=>{o.value=!1;const t=e.dataTransfer.files;t&&t.length>0&&(a.value=t[0],l.value="",i.value="")},m=async()=>{if(!a.value)return void alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ ZIP æª”æ¡ˆï¼");const s=a.value;if("application/zip"===s.type||s.name.endsWith(".zip")){i.value="",r.value="",t.value=!0,n.value="info",l.value="ğŸš€ æ­£åœ¨ä¸Šå‚³æ–‡ä»¶ä¸¦å»ºç«‹å‘é‡è³‡æ–™åº«...é€™å¯èƒ½éœ€è¦ä¸€é»æ™‚é–“ï¼Œè«‹å‹¿é—œé–‰è¦–çª—ã€‚";try{const t=new FormData;t.append("file",a.value);const s=await fetch(e,{method:"POST",body:t});if(!s.ok){const e=await s.text();throw new Error(`ä¼ºæœå™¨éŒ¯èª¤: ${s.status} - ${e}`)}const o=await s.blob();i.value=window.URL.createObjectURL(o),r.value="rag_db.zip";const u=s.headers.get("Content-Disposition");if(u){const e=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/,a=e.exec(u);if(null!=a&&a[1])r.value=a[1].replace(/['"]/g,"");else{const e=u.match(/filename[^;=\n]*=([^;\n]+)/);e&&e[1]&&(r.value=e[1].trim().replace(/['"]/g,""))}}n.value="success",l.value="âœ… æˆåŠŸï¼æ‚¨çš„ RAG è³‡æ–™åº«æª”æ¡ˆå·²æº–å‚™å¥½ä¸‹è¼‰ã€‚"}catch(o){n.value="error",l.value=`âŒ ç™¼ç”ŸéŒ¯èª¤: ${o.message}`}finally{t.value=!1}}else alert("éŒ¯èª¤ï¼šåƒ…æ”¯æ´ .zip æ ¼å¼çš„å£“ç¸®æª”")},h=()=>{setTimeout(()=>{i.value&&window.URL.revokeObjectURL(i.value)},100)};return{selectedFile:a,isProcessing:t,statusMessage:l,statusClass:d,downloadUrl:i,downloadFileName:r,isDragOver:o,uploadText:u,buttonText:c,handleFileSelect:v,handleDragOver:p,handleDragLeave:g,handleDrop:y,processFile:m,handleDownload:h}}};const hn=(0,c.A)(mn,[["render",yn],["__scopeId","data-v-46f87267"]]);var fn=hn;const bn={class:"ask-container"},kn={class:"ask-card"},Ln={key:0,class:"file-info"},wn={class:"question-area"},xn=["disabled"],Tn={key:0,class:"loader"},Cn={key:2,class:"result"},Dn={class:"result-section"},En={class:"result-content"},_n={class:"result-section"},Rn={class:"result-content"},In={key:0,class:"result-section"},Xn={class:"result-sources"};function Mn(e,a,t,n,i,r){return(0,s.uX)(),(0,s.CE)("div",bn,[(0,s.Lk)("div",kn,[a[12]||(a[12]=(0,s.Lk)("h1",{class:"title"},"â“ ä¸Šå‚³ RAG è³‡æ–™åº«å•å•é¡Œ",-1)),a[13]||(a[13]=(0,s.Lk)("p",{class:"description"},[(0,s.eW)(" è«‹ä¸Šå‚³å‰›å‰›ä¸‹è¼‰çš„ "),(0,s.Lk)("strong",null,"rag_db.zip"),(0,s.eW)("ï¼Œä¸¦è¼¸å…¥æ‚¨çš„å•é¡Œï¼Œç³»çµ±æœƒå›å‚³ AI å›ç­”èˆ‡ä¾†æºæª”æ¡ˆã€‚ ")],-1)),a[14]||(a[14]=(0,s.Lk)("div",{class:"tip"},[(0,s.eW)(" ğŸ’¡ "),(0,s.Lk)("strong",null,"æç¤ºï¼š"),(0,s.eW)("è«‹ä¸Šå‚³ "),(0,s.Lk)("strong",null,"rag_db.zip"),(0,s.eW)("ï¼ˆä¸è¦å‚³åŸå§‹ PDFï¼‰ï¼Œå•é¡Œå¯è¼¸å…¥å¦‚ã€Œé€™ä»½æ–‡ä»¶çš„çµè«–æ˜¯ä»€éº¼ï¼Ÿã€ã€‚ ")],-1)),(0,s.Lk)("div",{class:(0,g.C4)(["upload-area",{"drag-over":n.isDragOver}]),onClick:a[1]||(a[1]=a=>e.$refs.fileInput.click()),onDragover:a[2]||(a[2]=(0,l.D$)((...e)=>n.handleDragOver&&n.handleDragOver(...e),["prevent"])),onDragleave:a[3]||(a[3]=(0,l.D$)((...e)=>n.handleDragLeave&&n.handleDragLeave(...e),["prevent"])),onDrop:a[4]||(a[4]=(0,l.D$)((...e)=>n.handleDrop&&n.handleDrop(...e),["prevent"]))},[(0,s.Lk)("input",{ref:"fileInput",type:"file",accept:".zip",onChange:a[0]||(a[0]=(...e)=>n.handleFileSelect&&n.handleFileSelect(...e)),style:{display:"none"}},null,544),(0,s.Lk)("span",null,(0,g.v_)(n.uploadText),1)],34),n.selectedFile?((0,s.uX)(),(0,s.CE)("div",Ln," ğŸ“¦ å·²é¸æ“‡: "+(0,g.v_)(n.selectedFile.name),1)):(0,s.Q3)("",!0),(0,s.Lk)("div",wn,[a[8]||(a[8]=(0,s.Lk)("label",{class:"question-label",for:"question-input"},"å•é¡Œ",-1)),(0,s.bo)((0,s.Lk)("textarea",{id:"question-input",class:"question-input",rows:"4",placeholder:"ä¾‹å¦‚ï¼šé€™ä»½æ–‡ä»¶çš„çµè«–æ˜¯ä»€éº¼ï¼Ÿ","onUpdate:modelValue":a[5]||(a[5]=e=>n.questionText=e),onInput:a[6]||(a[6]=(...e)=>n.clearResult&&n.clearResult(...e))},null,544),[[l.Jo,n.questionText,void 0,{trim:!0}]])]),(0,s.Lk)("button",{class:"submit-btn",onClick:a[7]||(a[7]=(...e)=>n.submitQuestion&&n.submitQuestion(...e)),disabled:!n.selectedFile||!n.questionText||n.isProcessing},[n.isProcessing?((0,s.uX)(),(0,s.CE)("span",Tn)):(0,s.Q3)("",!0),(0,s.Lk)("span",null,(0,g.v_)(n.buttonText),1)],8,xn),n.statusMessage?((0,s.uX)(),(0,s.CE)("div",{key:1,class:(0,g.C4)(["status",n.statusClass])},(0,g.v_)(n.statusMessage),3)):(0,s.Q3)("",!0),n.resultAnswer?((0,s.uX)(),(0,s.CE)("div",Cn,[(0,s.Lk)("div",Dn,[a[9]||(a[9]=(0,s.Lk)("div",{class:"result-title"},"å•é¡Œ",-1)),(0,s.Lk)("div",En,(0,g.v_)(n.resultQuestion),1)]),(0,s.Lk)("div",_n,[a[10]||(a[10]=(0,s.Lk)("div",{class:"result-title"},"å›ç­”",-1)),(0,s.Lk)("div",Rn,(0,g.v_)(n.resultAnswer),1)]),n.resultSources.length?((0,s.uX)(),(0,s.CE)("div",In,[a[11]||(a[11]=(0,s.Lk)("div",{class:"result-title"},"ä¾†æº",-1)),(0,s.Lk)("ul",Xn,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.resultSources,e=>((0,s.uX)(),(0,s.CE)("li",{key:e},(0,g.v_)(e),1))),128))])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),a[15]||(a[15]=(0,s.Lk)("div",{class:"note"},[(0,s.eW)(" âš ï¸ "),(0,s.Lk)("strong",null,"æ³¨æ„ï¼š"),(0,s.Lk)("br"),(0,s.eW)(" 1. æª”æ¡ˆå¤§å°è«‹å‹¿éå¤§ï¼Œä»¥å…é€£ç·šé€¾æ™‚ã€‚"),(0,s.Lk)("br"),(0,s.eW)(" 2. è‹¥ Hugging Face ä¸»æ©Ÿä¼‘çœ ä¸­ï¼Œé¦–æ¬¡åŸ·è¡Œå¯èƒ½éœ€ç­‰å¾… 1-3 åˆ†é˜å–šé†’ã€‚ ")],-1))])])}var Fn={name:"AskView",setup(){const e="https://kevin7261-gisgym.hf.space/ask_with_zip",a=(0,x.KR)(null),t=(0,x.KR)(""),l=(0,x.KR)(!1),n=(0,x.KR)(""),i=(0,x.KR)(""),r=(0,x.KR)(!1),o=(0,x.KR)(""),u=(0,x.KR)(""),c=(0,x.KR)([]),d=(0,s.EW)(()=>r.value?"æ”¾é–‹ä»¥ä¸Šå‚³æª”æ¡ˆ":"é»æ“Šæˆ–æ‹–æ›³ ZIP æª”æ¡ˆè‡³æ­¤"),v=(0,s.EW)(()=>l.value?"é›²ç«¯é‹ç®—ä¸­...":"ä¸Šå‚³ä¸¦æå•"),p=(0,s.EW)(()=>`status-${i.value}`),g=()=>{o.value="",u.value="",c.value=[],n.value=""},y=e=>{const t=e.target.files;t&&t.length>0&&(a.value=t[0],g())},m=()=>{r.value=!0},h=()=>{r.value=!1},f=e=>{r.value=!1;const t=e.dataTransfer.files;t&&t.length>0&&(a.value=t[0],g())},b=async()=>{if(!a.value)return void alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ rag_db.zip æª”æ¡ˆï¼");if(!t.value)return void alert("è«‹è¼¸å…¥å•é¡Œå…§å®¹ï¼");const s=a.value;if("application/zip"===s.type||s.name.endsWith(".zip")){g(),l.value=!0,i.value="info",n.value="ğŸš€ æ­£åœ¨ä¸Šå‚³è³‡æ–™åº«ä¸¦æå•...é€™å¯èƒ½éœ€è¦ä¸€é»æ™‚é–“ï¼Œè«‹å‹¿é—œé–‰è¦–çª—ã€‚";try{const l=new FormData;l.append("file",a.value),l.append("question",t.value);const s=await fetch(e,{method:"POST",body:l});if(!s.ok){const e=await s.text();throw new Error(`ä¼ºæœå™¨éŒ¯èª¤: ${s.status} - ${e}`)}const r=await s.json();o.value=r.question||t.value,u.value=r.answer||"",c.value=Array.isArray(r.sources)?r.sources:[],i.value="success",n.value="âœ… æˆåŠŸï¼å·²å–å¾— AI å›ç­”ã€‚"}catch(r){i.value="error",n.value=`âŒ ç™¼ç”ŸéŒ¯èª¤: ${r.message}`}finally{l.value=!1}}else alert("éŒ¯èª¤ï¼šåƒ…æ”¯æ´ .zip æ ¼å¼çš„å£“ç¸®æª”")};return{selectedFile:a,questionText:t,isProcessing:l,statusMessage:n,statusClass:p,isDragOver:r,uploadText:d,buttonText:v,resultQuestion:o,resultAnswer:u,resultSources:c,handleFileSelect:y,handleDragOver:m,handleDragLeave:h,handleDrop:f,submitQuestion:b,clearResult:g}}};const Kn=(0,c.A)(Fn,[["render",Mn],["__scopeId","data-v-4c69a347"]]);var Wn=Kn;const jn=[{path:"/",name:"Home",component:rn,meta:{title:"GISGym",description:"GISGym",requiresAuth:!1}},{path:"/rag",name:"Rag",component:fn,meta:{title:"PDF è½‰å‘é‡åº« (RAG)",description:"PDF æ–‡ä»¶è½‰æ›ç‚º FAISS å‘é‡åº«",requiresAuth:!1}},{path:"/ask",name:"Ask",component:Wn,meta:{title:"ä¸Šå‚³ RAG è³‡æ–™åº«å•å•é¡Œ",description:"ä¸Šå‚³ rag_db.zip ä¸¦å‘ AI æå•",requiresAuth:!1}}],zn=(0,p.aE)({history:(0,p.LA)("/gisgym/"),routes:jn,scrollBehavior(e,a,t){return t||{top:0}}});zn.beforeEach((e,a,t)=>{e.meta.title?document.title=`${e.meta.title} - GISGym`:document.title="GISGym",t()}),zn.afterEach(()=>{});var Sn=zn;t(323);const Nn=(0,l.Ef)(v),An=(0,n.Ey)();Nn.use(Sn),Nn.use(An),Nn.mount("#app")}},a={};function t(l){var n=a[l];if(void 0!==n)return n.exports;var s=a[l]={exports:{}};return e[l].call(s.exports,s,s.exports,t),s.exports}t.m=e,function(){var e=[];t.O=function(a,l,n,s){if(!l){var i=1/0;for(c=0;c<e.length;c++){l=e[c][0],n=e[c][1],s=e[c][2];for(var r=!0,o=0;o<l.length;o++)(!1&s||i>=s)&&Object.keys(t.O).every(function(e){return t.O[e](l[o])})?l.splice(o--,1):(r=!1,s<i&&(i=s));if(r){e.splice(c--,1);var u=n();void 0!==u&&(a=u)}}return a}s=s||0;for(var c=e.length;c>0&&e[c-1][2]>s;c--)e[c]=e[c-1];e[c]=[l,n,s]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var l in a)t.o(a,l)&&!t.o(e,l)&&Object.defineProperty(e,l,{enumerable:!0,get:a[l]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){var e={524:0};t.O.j=function(a){return 0===e[a]};var a=function(a,l){var n,s,i=l[0],r=l[1],o=l[2],u=0;if(i.some(function(a){return 0!==e[a]})){for(n in r)t.o(r,n)&&(t.m[n]=r[n]);if(o)var c=o(t)}for(a&&a(l);u<i.length;u++)s=i[u],t.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return t.O(c)},l=self["webpackChunkgisgym"]=self["webpackChunkgisgym"]||[];l.forEach(a.bind(null,0)),l.push=a.bind(null,l.push.bind(l))}();var l=t.O(void 0,[504],function(){return t(440)});l=t.O(l)})();
//# sourceMappingURL=app.9dae28b7.js.map